<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport"
      content="width=device-width,
               initial-scale=1.0,
               maximum-scale=1.0,
               user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<title>Точковка</title>

<style>
/* ------------------------------------------------------
   GLOBAL THEME — Liquid Glass VisionOS (Touch reactive)
-------------------------------------------------------*/

:root {
  --glass: rgba(255,255,255,0.12);
  --glass2: rgba(255,255,255,0.18);
  --border: rgba(255,255,255,0.25);
  --text: rgba(255,255,255,0.95);
  --subtext: rgba(255,255,255,0.55);
  --rainbow:
    radial-gradient(circle at var(--x,50%) var(--y,50%),
      rgba(255,0,120,0.3),
      transparent 50%),
    radial-gradient(circle at calc(100% - var(--x,50%)) calc(100% - var(--y,50%)),
      rgba(0,180,255,0.28),
      transparent 55%),
    radial-gradient(circle at var(--x,50%) calc(100% - var(--y,50%)),
      rgba(90,0,255,0.3),
      transparent 50%);
}

body {
  margin:0;
  padding:0;
  height:100dvh;
  background:linear-gradient(180deg, #000008, #0b0b10);
  overflow:hidden;
  font-family:-apple-system, system-ui, sans-serif;
  color:white;
}

/* ------------------------------------------------------
 HEADER
-------------------------------------------------------*/
header{
  text-align:center;
  padding:60px 20px 18px;
  font-size:42px;
  font-weight:900;
  background:linear-gradient(90deg,#fff,#eaeaea);
  -webkit-background-clip:text;
  -webkit-text-fill-color:transparent;
}

/* ------------------------------------------------------
   PLAN PANEL (Glass)
-------------------------------------------------------*/
.plan{
  margin:0 20px;
  padding:24px;
  border-radius:28px;
  background:var(--glass2);
  border:1px solid var(--border);
  backdrop-filter:blur(35px);
  -webkit-backdrop-filter:blur(35px);
  position:relative;
  overflow:hidden;
}

.plan::before{
  content:"";
  position:absolute;
  inset:0;
  background:var(--rainbow);
  opacity:0.45;
  filter:blur(40px);
  pointer-events:none;
}

.plan::after{
  content:"";
  position:absolute;
  inset:0;
  border-radius:28px;
  background:linear-gradient(to bottom,
      rgba(255,255,255,0.45),
      rgba(255,255,255,0.03) 50%);
  mix-blend-mode:overlay;
  pointer-events:none;
}

#plan{
  width:100%;
  padding:18px;
  margin-bottom:18px;
  font-size:38px;
  background:rgba(255,255,255,0.10);
  border:1px solid var(--border);
  border-radius:22px;
  color:white;
  text-align:center;
  font-weight:800;
}

/* PROGRESS BAR */
.pr{
  height:16px;
  background:rgba(255,255,255,0.20);
  border-radius:10px;
  overflow:hidden;
}
.fill{
  height:100%;
  width:0%;
  background:linear-gradient(90deg,#fff,#ececec);
  transition:width .4s;
}
.fill.over{
  background:linear-gradient(90deg,#bbffbb,#ffeab4);
}

.done{
  text-align:center;
  margin-top:12px;
  font-size:30px;
  font-weight:900;
}
.left{
  text-align:center;
  font-size:20px;
  margin-top:6px;
  color:var(--subtext);
}

/* ------------------------------------------------------
   TRUCK LIST — EXACT 5 CARDS
-------------------------------------------------------*/
.list{
  position:absolute;
  top:300px;
  left:0;
  right:0;
  bottom:120px;
  padding:0 20px;
  display:flex;
  flex-direction:column;
  justify-content:space-between;
  overflow:hidden;
}

.t{
  position:relative;
  padding:18px;
  border-radius:26px;
  overflow:hidden;

  /* LIQUID GLASS BASE */
  background:var(--glass2);
  border:1px solid var(--border);
  backdrop-filter:blur(40px);
  -webkit-backdrop-filter:blur(40px);

  /* RAINBOW MOTION */
  background-image:var(--rainbow);
  background-blend-mode:screen;
}

.t::before{
  content:"";
  position:absolute;
  inset:0;
  pointer-events:none;
  background:linear-gradient(to bottom,
    rgba(255,255,255,0.40),
    rgba(255,255,255,0.02) 55%);
}

/* UI inside card */
.chk{
  width:30px;
  height:30px;
}
.n{
  width:70px;
  text-align:center;
  font-size:30px;
  font-weight:800;
}
.b{
  width:54px;
  height:54px;
  border-radius:27px;
  border:1px solid var(--border);
  background:rgba(255,255,255,0.12);
  backdrop-filter:blur(25px);
  -webkit-backdrop-filter:blur(25px);
  font-size:36px;
  color:white;
}
.c{
  width:90px;
  text-align:center;
  font-size:40px;
  font-weight:900;
}
.v{
  margin-left:auto;
  padding:10px 14px;
  border-radius:16px;
  background:rgba(255,255,255,0.14);
  border:1px solid var(--border);
}

/* ------------------------------------------------------
 FLOAT BUTTON (...)
-------------------------------------------------------*/
.fab{
  position:fixed;
  bottom:max(28px, env(safe-area-inset-bottom));
  left:50%;
  transform:translateX(-50%);
  width:66px;
  height:66px;
  border-radius:33px;
  background:var(--glass2);
  border:1px solid var(--border);
  backdrop-filter:blur(35px);
  -webkit-backdrop-filter:blur(35px);
  font-size:32px;
  color:white;
  z-index:90;
}

/* ------------------------------------------------------
 BOTTOM SHEET
-------------------------------------------------------*/
.sh{
  position:fixed;
  left:0;
  right:0;
  bottom:-360px;
  padding:26px;
  padding-bottom:max(40px, env(safe-area-inset-bottom));
  background:rgba(15,15,20,0.92);
  backdrop-filter:blur(40px);
  -webkit-backdrop-filter:blur(40px);
  border-radius:30px 30px 0 0;
  border-top:1px solid var(--border);
  transition:bottom .35s ease-out;
  z-index:200;
}
.sh.open{
  bottom:0;
}

.h{
  width:46px;
  height:6px;
  background:rgba(255,255,255,0.35);
  border-radius:3px;
  margin:0 auto 22px;
}

.sh button{
  width:100%;
  padding:20px;
  margin-bottom:16px;
  border-radius:24px;
  border:1px solid var(--border);
  background:var(--glass2);
  backdrop-filter:blur(40px);
  -webkit-backdrop-filter:blur(40px);
  font-size:22px;
  color:white;
}
</style>
</head>

<body>

<header>Точковка</header>

<div class="plan">
  <input id="plan" type="number" value="3000">
  <div class="pr"><div class="fill" id="f"></div></div>
  <div class="done" id="done">0 м³</div>
  <div class="left" id="left">Осталось: 3000 м³</div>
</div>

<div class="list" id="list"></div>

<button class="fab" onclick="s.classList.toggle('open')">⋯</button>

<div class="sh" id="s">
  <div class="h"></div>
  <button onclick="add();s.classList.remove('open')">Добавить БелАЗ</button>
  <button onclick="wa();s.classList.remove('open')">Отправить диспетчеру</button>
  <button onclick="res();s.classList.remove('open')">Сбросить смену</button>
</div>

<script>
/* ------------------------------
   DATA
-------------------------------*/
let trucks = JSON.parse(localStorage.getItem('toch2025_final')) || [];
let target = +localStorage.getItem('target2025') || 3000;

document.getElementById('plan').value = target;

trucks = trucks.map(x => ({
  n: x.n || "??",
  c: x.c || 0,
  v: x.v || 37.8,
  on: x.on !== false
}));

function save(){
  localStorage.setItem('toch2025_final', JSON.stringify(trucks));
  localStorage.setItem('target2025', target);
}

function update(){
  const total = trucks.reduce((s,x)=>s + (x.on ? x.c*x.v : 0), 0);
  const left = Math.max(0, target - total);
  f.style.width = Math.min(total/target*100, 120) + "%";
  done.textContent = Math.round(total) + " м³";
  left === 0 ?
    left.textContent = "НОРМА ВЫПОЛНЕНА" :
    left.textContent = `Осталось: ${Math.round(left)} м³`;
}

function render(){
  list.innerHTML = trucks.map((x,i)=>`
    <div class="t">
      <input type="checkbox" class="chk"
             ${x.on?"checked":""}
             onchange="tog(${i})">

      <div class="n">${x.n}</div>

      <button class="b" onclick="event.stopPropagation();ch(${i},-1)">–</button>

      <div class="c">${x.c}</div>

      <button class="b" onclick="event.stopPropagation();ch(${i},1)">+</button>

      <div class="v"
           onclick="event.stopPropagation();cv(${i})">${x.v} м³</div>
    </div>
  `).join('');
  update();
}

window.tog = i => {
  trucks[i].on = !trucks[i].on;
  save(); render();
};

window.ch = (i,d)=>{
  trucks[i].c = Math.max(0, trucks[i].c + d);
  save(); render();
  navigator.vibrate?.(30);
};

window.cv = i=>{
  let v = prompt("Кубатура", trucks[i].v);
  if(v && !isNaN(v)){
    trucks[i].v = +v;
    save(); render();
  }
};

window.add = ()=>{
  if(trucks.length >= 5){
    alert("Максимум 5 БелАЗов!");
    return;
  }
  let n = prompt("Номер БелАЗа")?.trim().toUpperCase();
  if(!n || trucks.some(x=>x.n===n)) return;
  let v = prompt("Кубатура", 37.8) || 37.8;
  trucks.push({n, c:0, v:+v, on:true});
  save(); render();
};

window.wa = ()=>{
  const txt = trucks
    .filter(x=>x.on && x.c>0)
    .map(x=>`${x.n} — ${x.c}`)
    .join("\n") || "—";

  location.href="whatsapp://send?text="+encodeURIComponent(txt);
};

window.res = ()=>{
  if(confirm("Сбросить смену?")){
    trucks=[];
    save(); render();
  }
};

plan.onchange = e=>{
  target = +e.target.value || 3000;
  save(); update();
};

render();

/* ------------------------------------------------------------------
   LIQUID GLASS TOUCH REACTIVE (Balanced sensitivity)
-------------------------------------------------------------------*/
let root = document.documentElement;

document.addEventListener("pointermove", e=>{
  let r = root.getBoundingClientRect();
  let x = e.clientX / window.innerWidth * 100;
  let y = e.clientY / window.innerHeight * 100;

  root.style.setProperty('--x', x + "%");
  root.style.setProperty('--y', y + "%");
});
</script>

</body>
</html>