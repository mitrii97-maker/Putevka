<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–ö—Ä–µ—Å—Ç–∏–∫–∏-–Ω–æ–ª–∏–∫–∏ –¥–ª—è –Ω–∞—Å –¥–≤–æ–∏—Ö ‚ù§Ô∏è</title>
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getDatabase, ref, onValue, set, remove } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

    const firebaseConfig = {
  apiKey: "AIzaSyAzGea6sRTQek_bYAOnJdvKjKxd5sRgX7E",
  authDomain: "klicker-love.firebaseapp.com",
  databaseURL: "https://klicker-love-default-rtdb.europe-west1.firebasedatabase.app",
  projectId: "klicker-love",
  storageBucket: "klicker-love.firebasestorage.app",
  messagingSenderId: "805841292732",
  appId: "1:805841292732:web:8bfbe94ddbe6ac7b472fb9",
  measurementId: "G-L1H4GM9FQ8"
};

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    const gameRef = ref(db, "tictactoe");

    let mySymbol = null;
    let myName = prompt("–ö–∞–∫ —Ç–µ–±—è –∑–æ–≤—É—Ç? ‚ù§Ô∏è", "–õ—é–±–∏–º—ã–π ‚ù§Ô∏è");

    // –°–±—Ä–æ—Å –∏–≥—Ä—ã –ø–æ #reset
    if (location.hash === "#reset") {
      remove(gameRef);
      location.hash = "";
      location.reload();
    }

    // –í—ã–±–æ—Ä —Å—Ç–æ—Ä–æ–Ω—ã
    onValue(gameRef, snap => {
      const data = snap.val();
      if (!data) {
        // –ù–æ–≤–∞—è –∏–≥—Ä–∞
        document.getElementById("wait").style.display = "block";
        document.getElementById("board").style.display = "none";
      } else {
        document.getElementById("wait").style.display = "none";
        document.getElementById("board").style.display = "grid";

        if (!mySymbol) {
          mySymbol = data.player1 ? "O" : "X";
          alert(`–¢—ã –∏–≥—Ä–∞–µ—à—å –∑–∞ ${mySymbol === "X" ? "–∫—Ä–µ—Å—Ç–∏–∫–∏" : "–Ω–æ–ª–∏–∫–∏"} ${mySymbol}`);
        }

        renderBoard(data.board || Array(9).fill(null));
        updateTurn(data.turn);
        checkWinner(data.winner);
      }
    });

    function makeMove(index) {
      if (mySymbol !== gameRef.turn && gameRef.winner) return;
      set(gameRef, {
        board: [...(gameRef.board || Array(9).fill(null))].map((c,i) => i===index ? mySymbol : c),
        turn: mySymbol === "X" ? "O" : "X",
        player1: true,
        winner: null
      });
    }

    function renderBoard(board) {
      board.forEach((cell, i) => {
        const el = document.getElementById(`c${i}`);
        el.textContent = cell || "";
        el.className = cell ? "filled" : "";
      });
    }

    function updateTurn(turn) {
      document.getElementById("status").textContent = 
        turn ? `–•–æ–¥: ${turn === "X" ? "‚úï" : "‚óØ"}` : "–û–∂–∏–¥–∞–Ω–∏–µ –≤—Ç–æ—Ä–æ–≥–æ –∏–≥—Ä–æ–∫–∞...";
    }

    function checkWinner(winner) {
      if (winner === "draw") {
        document.getElementById("status").textContent = "ü§ù –ù–∏—á—å—è! –í—ã –∏–¥–µ–∞–ª—å–Ω–∞—è –ø–∞—Ä–∞ ‚ù§Ô∏è";
      } else if (winner) {
        document.getElementById("status").textContent = `${winner === mySymbol ? "üéâ –¢—ã –≤—ã–∏–≥—Ä–∞–ª(–∞)!" : "ü•π –¢—ã –ø—Ä–æ–∏–≥—Ä–∞–ª(–∞)..."} ${winner} –ø–æ–±–µ–¥–∏–ª(–∞)!`;
      }
    }

    // –ö–ª–∏–∫ –ø–æ –∫–ª–µ—Ç–∫–µ
    document.querySelectorAll(".cell").forEach((cell, i) => {
      cell.onclick = () => makeMove(i);
    });

    // –ù–æ–≤–∞—è –∏–≥—Ä–∞
    document.getElementById("reset").onclick = () => {
      remove(gameRef);
      location.reload();
    };
  </script>

  <style>
    body {
      margin:0; min-height:100vh;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', sans-serif;
      color: white;
      display: flex; align-items: center; justify-content: center;
      overflow: hidden;
    }
    .container {
      width: 92vw; max-width: 420px;
      background: rgba(255,255,255,0.15);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      border-radius: 32px;
      border: 1px solid rgba(255,255,255,0.2);
      box-shadow: 0 25px 50px rgba(0,0,0,0.3);
      padding: 30px 20px;
      text-align: center;
      position: relative;
      overflow: hidden;
    }
    h1 {
      font-size: 36px; margin: 0 0 10px;
      background: linear-gradient(45deg, #ff9a9e, #fad0c4);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }
    #wait { font-size: 22px; padding: 60px 20px; }
    #board {
      display: grid; grid-template-columns: repeat(3,1fr);
      gap: 12px; margin: 40px auto; width: fit-content;
    }
    .cell {
      width: 90px; height: 90px;
      background: rgba(255,255,255,0.2);
      border-radius: 24px;
      font-size: 60px; font-weight: 300;
      display: flex; align-items: center; justify-content: center;
      cursor: pointer;
      transition: all 0.3s cubic-bezier(0.2, 0.8, 0.2, 1);
      backdrop-filter: blur(10px);
    }
    .cell:hover { transform: scale(1.08); background: rgba(255,255,255,0.35); }
    .filled { cursor: default; transform: scale(1); }
    .filled:nth-child(odd) { color: #ff6b9d; }
    .filled:nth-child(even) { color: #a8e6cf; }
    #status {
      font-size: 24px; margin: 20px 0; font-weight: 500;
      text-shadow: 0 2px 10px rgba(0,0,0,0.3);
    }
    button {
      background: rgba(255,255,255,0.25);
      border: none; border-radius: 20px;
      padding: 14px 32px; color: white;
      font-size: 18px; margin-top: 20px;
      cursor: pointer; backdrop-filter: blur(10px);
      transition: 0.3s;
    }
    button:hover { background: rgba(255,255,255,0.4); transform: translateY(-2px); }
    .heart { color: #ff6b9d; animation: pulse 2s infinite; }
    @keyframes pulse { 0%,100% { transform: scale(1); } 50% { transform: scale(1.3); } }
  </style>
</head>
<body>
  <div class="container">
    <h1>–ö—Ä–µ—Å—Ç–∏–∫–∏-–Ω–æ–ª–∏–∫–∏ <span class="heart">‚ù§Ô∏è</span></h1>
    <div id="wait">–û–∂–∏–¥–∞–Ω–∏–µ –≤—Ç–æ—Ä–æ–≥–æ –∏–≥—Ä–æ–∫–∞...</div>

    <div id="board" style="display:none">
      <div class="cell" id="c0"></div>
      <div class="cell" id="c1"></div>
      <div class="cell" id="c2"></div>
      <div class="cell" id="c3"></div>
      <div class="cell" id="c4"></div>
      <div class="cell" id="c5"></div>
      <div class="cell" id="c6"></div>
      <div class="cell" id="c7"></div>
      <div class="cell" id="c8"></div>
    </div>

    <div id="status">–û–∂–∏–¥–∞–Ω–∏–µ –≤—Ç–æ—Ä–æ–≥–æ –∏–≥—Ä–æ–∫–∞...</div>
    <button id="reset">–ù–æ–≤–∞—è –∏–≥—Ä–∞</button>
    <p style="margin-top:30px;font-size:14px;opacity:0.8">
      –ß—Ç–æ–±—ã —Å–±—Ä–æ—Å–∏—Ç—å: –¥–æ–±–∞–≤–∏—Ç—å #reset –≤ –∫–æ–Ω–µ—Ü —Å—Å—ã–ª–∫–∏
    </p>
  </div>
</body>
</html>
