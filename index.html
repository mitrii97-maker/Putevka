<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Экскаватор</title>

<style>
/* === iOS 26 Liquid Glass Variables === */
:root {
  --bg1: #0b0b10;
  --bg2: #15151d;
  --glass: rgba(255,255,255,0.07);
  --glass-strong: rgba(255,255,255,0.12);
  --border: rgba(255,255,255,0.18);
  --text: #fff;
  --text-dim: rgba(255,255,255,0.55);
  --blue: #0a84ff;
  --green: #30d158;
  --red: #ff453a;
  --orange: #ff9f0a;
}

/* === GLOBAL === */
body {
  margin:0;
  background: radial-gradient(circle at top, var(--bg2), var(--bg1) 70%);
  font-family: -apple-system, BlinkMacSystemFont, sans-serif;
  color: var(--text);
  height:100vh;
  overflow:hidden;
  display:flex;
  flex-direction:column;
}

/* === LIQUID TITLE === */
header {
  text-align:center;
  padding:36px 0 20px;
  font-size:34px;
  font-weight:800;
  background:linear-gradient(90deg,var(--blue),var(--green));
  -webkit-background-clip:text;
  -webkit-text-fill-color:transparent;
}

/* === GLASS PANELS === */
.glass {
  margin:12px 18px;
  padding:18px;
  border-radius:22px;
  background:var(--glass);
  border:1px solid var(--border);
  backdrop-filter: blur(24px);
  box-shadow:0 10px 30px rgba(0,0,0,0.35);
}

/* Plan input */
#plan {
  width:100%;
  padding:10px;
  font-size:32px;
  text-align:center;
  background:var(--glass-strong);
  border-radius:16px;
  border:1px solid var(--border);
  color:var(--text);
}

/* Progress */
.progress {
  height:14px;
  margin-top:12px;
  background:rgba(255,255,255,.12);
  border-radius:8px;
  overflow:hidden;
}

.fill {
  height:100%;
  width:0%;
  background:linear-gradient(90deg,var(--blue),var(--green));
  transition:width .4s ease;
}

.fill.over {
  background:linear-gradient(90deg,var(--green),var(--orange));
}

.stats {
  margin-top:10px;
  font-size:24px;
  font-weight:700;
  text-align:center;
}

.over-text {
  display:none;
  text-align:center;
  margin-top:6px;
  font-size:26px;
  color:var(--orange);
}

.timer {
  text-align:center;
  font-size:16px;
  color:var(--text-dim);
  margin-bottom:6px;
}

/* === TRUCK LIST === */
.trucks {
  padding:0 18px;
  display:flex;
  flex-direction:column;
  gap:10px;
  max-height:360px;
  overflow:hidden;
}

.truck {
  position:relative;
  height:70px;
  display:flex;
  align-items:center;
  padding:12px 16px;
  background:var(--glass-strong);
  border-radius:18px;
  border:1px solid var(--border);
  transition:transform .15s ease;
}

/* DELETE BG (hidden until swipe) */
.truck .delete {
  position:absolute;
  left:0; top:0; bottom:0;
  width:90px;
  background:var(--red);
  color:#fff;
  font-size:20px;
  font-weight:600;
  display:flex;
  align-items:center;
  justify-content:center;
  border-radius:18px 0 0 18px;
  pointer-events:none;
  opacity:0;
}

/* Content */
.num {
  font-size:26px;
  font-weight:800;
  width:65px;
  text-align:center;
}

.count {
  width:70px;
  text-align:center;
  font-size:42px;
  font-weight:800;
}

.vol {
  margin-left:auto;
  font-size:22px;
  color:var(--text-dim);
}

/* Buttons */
.btn {
  width:46px;
  height:46px;
  border:none;
  border-radius:12px;
  font-size:28px;
  font-weight:700;
  color:white;
  margin:0 6px;
}

.plus { background:var(--blue); }
.minus { background:var(--red); }

/* === BOTTOM BAR === */
.bottom {
  position:fixed;
  bottom:0;
  left:0;
  right:0;
  padding:16px;
  background:var(--glass);
  border-top:1px solid var(--border);
  backdrop-filter:blur(25px);
  display:flex;
  gap:12px;
}

.fab {
  flex:1;
  padding:14px;
  border:none;
  border-radius:16px;
  color:#fff;
  font-weight:700;
  font-size:18px;
}

.fab-blue { background:var(--blue); }
.fab-green { background:var(--green); }
.fab-orange { background:var(--orange); }
</style>
</head>

<body>

<header>Экскаватор</header>

<div class="glass">
  <div style="text-align:center; font-size:18px; color:var(--text-dim)">Наряд (м³)</div>
  <input id="plan" type="number" value="3000">
  <div class="progress"><div id="fill" class="fill"></div></div>
  <div id="stats" class="stats">0 / 3000 м³</div>
  <div id="over" class="over-text">+0 м³</div>
</div>

<div id="timer" class="timer">Смена: 00:00:00</div>

<div id="list" class="trucks"></div>

<div class="bottom">
  <button class="fab fab-blue" onclick="addTruck()">+ БелАЗ</button>
  <button class="fab fab-green" onclick="shareShift()">Поделиться</button>
  <button class="fab fab-orange" onclick="resetShift()">Сброс</button>
</div>

<script>
const V = 37.8;
let trucks = JSON.parse(localStorage.getItem("ex_tr")) || [];
let plan = +localStorage.getItem("ex_plan") || 3000;
let start = +localStorage.getItem("ex_start") || Date.now();

document.getElementById("plan").value = plan;

function save(){
  localStorage.setItem("ex_tr",JSON.stringify(trucks));
  localStorage.setItem("ex_plan",plan);
  localStorage.setItem("ex_start",start);
}

/* === UPDATE UI === */
function update(){
  let total = trucks.reduce((s,t)=>s+t.c*V,0);
  let pct = total/plan*100;

  const fill = document.getElementById("fill");
  fill.style.width = Math.min(pct,200)+"%";

  document.getElementById("stats").textContent =
    `${Math.round(total)} / ${plan} м³`;

  const over = document.getElementById("over");

  if(total>plan){
    over.style.display="block";
    over.textContent = `+${Math.round(total-plan)} м³`;
    fill.classList.add("over");
  } else {
    over.style.display="none";
    fill.classList.remove("over");
  }
}

/* === RENDER LIST === */
function render(){
  const list=document.getElementById("list");
  list.innerHTML="";

  trucks.forEach((t,i)=>{
    const el=document.createElement("div");
    el.className="truck";

    const del=document.createElement("div");
    del.className="delete";
    del.textContent="Удалить";
    el.append(del);

    const row=document.createElement("div");
    row.style.display="flex";
    row.style.width="100%";
    row.style.alignItems="center";
    row.innerHTML=`
      <div class="num">${t.n}</div>
      <button class="btn minus">−</button>
      <div class="count">${t.c}</div>
      <button class="btn plus">+</button>
      <div class="vol">${(t.c*V).toFixed(1)} м³</div>
    `;
    el.append(row);

    /* + / - */
    row.querySelector(".plus").onclick=()=>{
      t.c++; save(); render();
    };
    row.querySelector(".minus").onclick=()=>{
      t.c=Math.max(0,t.c-1);
      if(t.c===0) trucks.splice(i,1);
      save(); render();
    };

    /* === SWIPE DELETE (НОВЫЙ iOS вариант) === */
    let x0=0;
    el.addEventListener("touchstart",e=>{
      x0=e.touches[0].clientX;
    });

    el.addEventListener("touchmove",e=>{
      let dx=e.touches[0].clientX-x0;
      if(dx<-30){
        el.style.transform="translateX(-70px)";
        del.style.opacity="1";
      }
    });

    el.addEventListener("touchend",e=>{
      let dx=e.changedTouches[0].clientX-x0;
      if(dx<-80){
        trucks.splice(i,1);
        save(); render();
      } else {
        el.style.transform="";
        del.style.opacity="0";
      }
    });

    list.append(el);
  });

  update();
}

/* === ADD === */
function addTruck(){
  let n = prompt("Номер БелАЗа")?.trim().toUpperCase();
  if(!n || trucks.some(t=>t.n===n)) return;
  trucks.push({n,c:0});
  save(); render();
}

/* === SHARE === */
function shareShift(){
  const total = trucks.reduce((s,t)=>s+t.c*V,0);
  const text = trucks.map(t=>`${t.n}: ${t.c} рейс`).join("\n") +
    `\nИтого: ${Math.round(total)} м³`;

  navigator.share ? navigator.share({text}) : alert(text);
}

/* === RESET === */
function resetShift(){
  if(confirm("Начать новую смену?")){
    trucks=[];
    start=Date.now();
    save();
    render();
  }
}

/* === PLAN === */
document.getElementById("plan").onchange=e=>{
  plan=+e.target.value||3000;
  save(); update();
};

/* === TIMER === */
setInterval(()=>{
  let s=Math.floor((Date.now()-start)/1000);
  let h=String(Math.floor(s/3600)).padStart(2,"0");
  let m=String(Math.floor((s%3600)/60)).padStart(2,"0");
  let sec=String(s%60).padStart(2,"0");
  document.getElementById("timer").textContent=`Смена: ${h}:${m}:${sec}`;
},1000);

render();
</script>

</body>
</html>
