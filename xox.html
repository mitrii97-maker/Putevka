<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport"
      content="width=device-width,
               initial-scale=1.0,
               maximum-scale=1.0,
               user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<title>Точковка</title>

<style>
/* ------------------------------------------------------
   GLOBAL THEME — iOS 26 Liquid Glass / Apple Music
-------------------------------------------------------*/
:root {
  --glass: rgba(255,255,255,0.10);
  --glass2: rgba(255,255,255,0.15);
  --border: rgba(255,255,255,0.24);
  --text: rgba(255,255,255,0.95);
  --subtext: rgba(255,255,255,0.55);
}

/* Global background — pure black + soft glow */
body {
  margin:0;
  padding:0;
  height:100dvh;
  background:#000;
  color:var(--text);
  font-family:-apple-system, system-ui, sans-serif;
  overflow:hidden; /* NO SCROLL ANYWHERE */
}

/* ------------------------------------------------------
   HEADER
-------------------------------------------------------*/
header{
  text-align:center;
  padding:60px 20px 20px;
  font-size:40px;
  font-weight:900;
  background:linear-gradient(90deg,#ffffff,#b5b5b5);
  -webkit-background-clip:text;
  -webkit-text-fill-color:transparent;
  text-shadow:0 0 32px rgba(255,255,255,0.25);
}

/* ------------------------------------------------------
   PLAN PANEL (Glass)
-------------------------------------------------------*/
.plan{
  margin:0 18px;
  padding:22px;
  border-radius:26px;
  background:var(--glass);
  border:1px solid var(--border);
  backdrop-filter:blur(40px);
  -webkit-backdrop-filter:blur(40px);
  box-shadow:0 0 60px rgba(255,255,255,0.06);
}

/* Bright Apple-style top gloss */
.plan::before{
  content:"";
  position:absolute;
  inset:0;
  border-radius:26px;
  background:linear-gradient(to bottom,
      rgba(255,255,255,0.35),
      rgba(255,255,255,0.02) 40%);
  pointer-events:none;
}

#plan{
  width:100%;
  padding:16px;
  margin-bottom:18px;
  background:var(--glass2);
  border:1px solid var(--border);
  border-radius:22px;
  font-size:40px;
  text-align:center;
  font-weight:800;
  color:white;
}

/* Progress bar */
.pr{
  height:16px;
  background:rgba(255,255,255,0.15);
  border-radius:8px;
  overflow:hidden;
}

.fill{
  height:100%;
  width:0%;
  background:linear-gradient(90deg,#fff,#ddd);
  transition:width .4s;
}

.fill.over{
  background:linear-gradient(90deg,#d5ffd5,#fff0b0);
}

.done{
  text-align:center;
  margin-top:14px;
  font-size:32px;
  font-weight:900;
}

.left{
  text-align:center;
  margin-top:6px;
  font-size:20px;
  color:var(--subtext);
}

/* ------------------------------------------------------
   TRUCK LIST — 5 CARDS FIXED
-------------------------------------------------------*/
.list{
  position:absolute;
  top:260px;
  left:0;
  right:0;
  bottom:110px;
  display:flex;
  flex-direction:column;
  justify-content:space-between; /* Spread 5 cards exactly */
  padding:0 18px;
  overflow:hidden; /* No scroll */
}

/* One big Apple Music style card */
.t{
  position:relative;
  padding:18px;
  height: calc((100% - 4 * 14px) / 5); /* EXACTLY 5 cards */
  border-radius:26px;
  background:var(--glass2);
  border:1px solid var(--border);
  display:flex;
  align-items:center;
  backdrop-filter:blur(40px);
  -webkit-backdrop-filter:blur(40px);
  box-shadow:0 25px 40px rgba(0,0,0,0.35);
  overflow:hidden;
}

/* Glass top gloss */
.t::before{
  content:"";
  position:absolute;
  inset:0;
  border-radius:26px;
  background:linear-gradient(
      to bottom,
      rgba(255,255,255,0.35),
      rgba(255,255,255,0.02) 45%
  );
  pointer-events:none;
}

/* Card elements */
.chk{
  width:30px;
  height:30px;
  margin-right:16px;
}

.n{
  width:70px;
  text-align:center;
  font-size:32px;
  font-weight:800;
}

.c{
  font-size:44px;
  width:110px;
  text-align:center;
  font-weight:900;
}

.b{
  width:58px;
  height:58px;
  border-radius:29px;
  border:1px solid var(--border);
  background:var(--glass);
  margin:0 12px;
  font-size:36px;
  color:white;
  backdrop-filter:blur(30px);
  -webkit-backdrop-filter:blur(30px);
}

.v{
  margin-left:auto;
  padding:10px 18px;
  background:var(--glass);
  border-radius:18px;
  border:1px solid var(--border);
  font-size:20px;
}

/* ------------------------------------------------------
   FLOAT BUTTON (...) — glass sphere
-------------------------------------------------------*/
.fab{
  position:fixed;
  bottom: max(26px, env(safe-area-inset-bottom));
  left:50%;
  transform:translateX(-50%);
  width:64px;
  height:64px;
  background:var(--glass2);
  border-radius:32px;
  border:1px solid var(--border);
  backdrop-filter:blur(40px);
  -webkit-backdrop-filter:blur(40px);
  font-size:30px;
  color:white;
  z-index:50;
}

/* ------------------------------------------------------
   BOTTOM SHEET (Glass)
-------------------------------------------------------*/
.sh{
  position:fixed;
  left:0;
  right:0;
  bottom:-380px;
  padding:28px 22px;
  padding-bottom:max(40px, env(safe-area-inset-bottom));
  background:rgba(20,20,20,0.9);
  border-radius:30px 30px 0 0;
  border-top:1px solid var(--border);
  backdrop-filter:blur(45px);
  -webkit-backdrop-filter:blur(45px);
  box-shadow:0 -20px 60px rgba(0,0,0,0.5);
  transition:bottom .35s cubic-bezier(0.16,1,0.3,1);
  z-index:200;
}

.sh.open { bottom:0; }

.h{
  width:50px;
  height:6px;
  background:rgba(255,255,255,0.35);
  border-radius:3px;
  margin:0 auto 26px;
}

.sh button{
  width:100%;
  padding:20px;
  margin-bottom:18px;
  border-radius:24px;
  border:1px solid var(--border);
  background:var(--glass2);
  backdrop-filter:blur(40px);
  font-size:22px;
  color:white;
}
</style>
</head>

<body>

<header>Точковка</header>

<div class="plan">
  <input id="plan" type="number" value="3000">
  <div class="pr"><div class="fill" id="f"></div></div>
  <div class="done" id="done">0 м³</div>
  <div class="left" id="left">Осталось: 3000 м³</div>
</div>

<div class="list" id="list"></div>

<button class="fab" onclick="s.classList.toggle('open')">⋯</button>

<div class="sh" id="s">
  <div class="h"></div>
  <button onclick="add();s.classList.remove('open')">Добавить БелАЗ</button>
  <button onclick="wa();s.classList.remove('open')">Отправить диспетчеру</button>
  <button onclick="res();s.classList.remove('open')">Сбросить смену</button>
</div>

<script>
let trucks = JSON.parse(localStorage.getItem('toch2025_final')) || [];
let target = +localStorage.getItem('target2025') || 3000;

document.getElementById('plan').value = target;

/* Normalize */
trucks = trucks.map(x => ({
  n: x.n || "??",
  c: x.c || 0,
  v: x.v || 37.8,
  on: x.on !== false
}));

function save(){
  localStorage.setItem('toch2025_final', JSON.stringify(trucks));
  localStorage.setItem('target2025', target);
}

function update(){
  const total = trucks.reduce((s,x)=>s + (x.on ? x.c * x.v : 0), 0);
  const left  = Math.max(0, target - total);

  document.getElementById('f').style.width =
      Math.min((total / target) * 100, 120) + '%';

  done.textContent = Math.round(total) + " м³";

  left === 0
    ? left.textContent = "НОРМА ВЫПОЛНЕНА"
    : left.textContent = `Осталось: ${Math.round(left)} м³`;
}

function render(){
  list.innerHTML = trucks.slice(0,5).map((x,i)=>`
    <div class="t">
      <input type="checkbox" class="chk" ${x.on?'checked':''}
             onchange="tog(${i})">

      <div class="n">${x.n}</div>

      <button class="b m"
              onclick="event.stopPropagation();ch(${i},-1)">–</button>

      <div class="c"
           onclick="event.stopPropagation();ch(${i},5)">${x.c}</div>

      <button class="b"
              onclick="event.stopPropagation();ch(${i},1)">+</button>

      <div class="v"
           onclick="event.stopPropagation();cv(${i})">${x.v} м³</div>
    </div>
  `).join('');

  update();
}

window.tog = i => {
  trucks[i].on = !trucks[i].on;
  save(); render();
};

window.ch = (i,d) => {
  trucks[i].c = Math.max(0, trucks[i].c + d);
  save(); render();
  navigator.vibrate?.(30);
};

window.cv = i => {
  let v = prompt("Кубатура", trucks[i].v);
  if(v && !isNaN(v)){
    trucks[i].v = +v;
    save(); render();
  }
};

window.add = () => {
  if(trucks.length >= 5){
    alert("Максимум 5 БелАЗов на экран!");
    return;
  }
  let n = prompt("Номер БелАЗа")?.trim().toUpperCase();
  if(!n || trucks.some(x=>x.n === n)) return;

  let v = prompt("Кубатура", 37.8) || 37.8;

  trucks.push({n, c:0, v:+v, on:true});
  save(); render();
};

window.wa = () => {
  const txt = trucks
    .filter(x=>x.on && x.c>0)
    .map(x=>`${x.n} — ${x.c}`)
    .join('\n') || '—';

  location.href='whatsapp://send?text='+encodeURIComponent(txt);
};

window.res = () => {
  if(confirm("Сбросить смену?")){
    trucks=[];
    save(); render();
  }
};

plan.onchange = e=>{
  target = +e.target.value || 3000;
  save(); update();
};

render();
</script>

</body>
</html>