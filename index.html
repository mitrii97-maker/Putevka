<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
<title>–≠–∫—Å–∫–∞–≤–∞—Ç–æ—Ä</title>

<style>
:root {
  --accent: #007aff;
  --green: #30d158;
  --red: #ff3b30;
  --orange: #ff9f0a;
  --bg: #0a0a14;
  --glass: rgba(255,255,255,0.06);
  --glass-strong: rgba(255,255,255,0.15);
  --border: rgba(255,255,255,0.2);
  --text: #fff;
  --text-dim: rgba(255,255,255,0.6);
}

body {
  margin:0;
  background: var(--bg);
  font-family: -apple-system, BlinkMacSystemFont, sans-serif;
  color: var(--text);
  height: 100vh;
  overflow: hidden;
}

header {
  text-align:center;
  padding: 35px 0 15px;
  background: linear-gradient(90deg,#007aff,#30d158);
  -webkit-background-clip:text;
  -webkit-text-fill-color:transparent;
  font-size:40px;
  font-weight:900;
}

.glass {
  margin: 15px;
  padding: 20px;
  background: var(--glass);
  border-radius: 22px;
  border:1px solid var(--border);
  backdrop-filter: blur(30px);
}

#plan {
  width:100%;
  padding:10px;
  font-size:34px;
  font-weight:800;
  text-align:center;
  background: var(--glass-strong);
  color:var(--text);
  border-radius:16px;
  border:1px solid var(--border);
}

.progress {
  height:16px;
  background: rgba(255,255,255,.15);
  border-radius:8px;
  overflow:hidden;
  margin-top:12px;
}

.fill {
  height:100%;
  width:0%;
  background: linear-gradient(90deg,var(--accent),var(--green));
  transition: width .4s ease;
}

.fill.over {
  background: linear-gradient(90deg,var(--green),var(--orange));
}

.stats {
  text-align:center;
  font-size:26px;
  font-weight:800;
  margin-top:10px;
}

.over-text {
  text-align:center;
  font-size:28px;
  color:var(--orange);
  display:none;
}

.timer {
  text-align:center;
  margin-top:6px;
  font-size:18px;
  color:var(--text-dim);
}

.trucks {
  padding: 10px 15px;
  display:flex;
  flex-direction:column;
  gap:10px;
  max-height:380px; /* –ø–æ–º–µ—â–∞–µ—Ç—Å—è 5 —à—Ç—É–∫ */
  overflow:hidden;
}

.truck {
  background: var(--glass-strong);
  border-radius:18px;
  border:1px solid var(--border);
  display:flex;
  align-items:center;
  padding:14px;
  position:relative;
}

.num {
  font-size:28px;
  font-weight:800;
  width:70px;
  text-align:center;
}

.count {
  font-size:44px;
  width:80px;
  text-align:center;
  font-weight:900;
}

.vol {
  margin-left:auto;
  font-size:22px;
  opacity:.7;
}

.btn {
  width:50px;
  height:50px;
  border-radius:14px;
  border:none;
  font-size:34px;
  color:white;
  margin:0 5px;
}

.plus { background:var(--accent); }
.minus { background:var(--red); }

.bottom {
  position:fixed;
  bottom:0; left:0; right:0;
  background:var(--glass);
  backdrop-filter:blur(25px);
  padding:16px;
  border-top:1px solid var(--border);
  display:flex;
  gap:12px;
}

.fab {
  flex:1;
  padding:14px;
  font-size:18px;
  border-radius:16px;
  border:none;
  color:white;
  font-weight:700;
}

.fab-blue { background:var(--accent); }
.fab-green { background:var(--green); }
.fab-orange { background:var(--orange); }

/* —Å–≤–∞–π–ø delete */
.delete-bg {
  position:absolute;
  left:0;
  top:0; bottom:0;
  width:100px;
  background:var(--red);
  color:white;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:22px;
  transform:translateX(-100%);
}
</style>
</head>
<body>

<header>–≠–∫—Å–∫–∞–≤–∞—Ç–æ—Ä</header>

<div class="glass">
  <div style="font-size:18px; text-align:center; color:var(--text-dim)">–ù–∞—Ä—è–¥ (–º¬≥)</div>
  <input id="plan" type="number" value="3000">
  <div class="progress"><div class="fill" id="fill"></div></div>
  <div class="stats" id="stats">0 / 3000 –º¬≥</div>
  <div class="over-text" id="over">+0 –º¬≥ üî•</div>
</div>

<div class="timer" id="timer">–°–º–µ–Ω–∞: 00:00:00</div>

<div class="trucks" id="list"></div>

<div class="bottom">
  <button class="fab fab-blue" onclick="addTruck()">+ –ë–µ–ª–ê–ó</button>
  <button class="fab fab-green" onclick="shareShift()">–ü–æ–¥–µ–ª–∏—Ç—å—Å—è</button>
  <button class="fab fab-orange" onclick="resetShift()">–°–±—Ä–æ—Å</button>
</div>

<script>
const V=37.8;
let trucks = JSON.parse(localStorage.getItem("exc_trucks")) || [];
let plan = +localStorage.getItem("exc_plan") || 3000;
let start = +localStorage.getItem("exc_start") || Date.now();

document.getElementById("plan").value = plan;

function save(){
  localStorage.setItem("exc_trucks",JSON.stringify(trucks));
  localStorage.setItem("exc_plan",plan);
  localStorage.setItem("exc_start",start);
}

function update(){
  const total = trucks.reduce((s,t)=>s+t.c*V,0);
  const fill = document.getElementById("fill");
  const overEl=document.getElementById("over");

  let pct = total/plan*100;
  fill.style.width = Math.min(pct,200) + "%";

  document.getElementById("stats").textContent =
    `${Math.round(total)} / ${plan} –º¬≥`;

  if(total>plan){
    overEl.style.display="block";
    overEl.textContent = `+${Math.round(total-plan)} –º¬≥ üî•`;
    fill.classList.add("over");
  } else {
    overEl.style.display="none";
    fill.classList.remove("over");
  }
}

function render(){
  const list=document.getElementById("list");
  list.innerHTML="";

  trucks.forEach((t,i)=>{
    const item=document.createElement("div");
    item.className="truck";

    const del=document.createElement("div");
    del.className="delete-bg";
    del.textContent="–£–¥–∞–ª–∏—Ç—å";
    item.append(del);

    const content=document.createElement("div");
    content.style.display="flex";
    content.style.width="100%";
    content.style.alignItems="center";
    content.innerHTML=`
      <div class="num">${t.n}</div>
      <button class="btn minus">‚àí</button>
      <div class="count">${t.c}</div>
      <button class="btn plus">+</button>
      <div class="vol">${(t.c*V).toFixed(1)} –º¬≥</div>
    `;
    item.append(content);

    /* –ª–æ–≥–∏–∫–∞ +/- */
    content.querySelector(".plus").onclick=()=>{
      t.c++; save(); render();
    };
    content.querySelector(".minus").onclick=()=>{
      t.c=Math.max(0,t.c-1);
      if(t.c===0){ trucks.splice(i,1); }
      save(); render();
    };

    /* —Å–≤–∞–π–ø —É–¥–∞–ª–µ–Ω–∏–µ (–û–ü–¢–ò–ú–ò–ó–ò–†–û–í–ê–ù–û, –ë–ï–ó –î–£–ë–õ–ï–ô) */
    let startX=0;
    item.addEventListener("touchstart",e=>{
      startX=e.touches[0].clientX;
    });

    item.addEventListener("touchmove",e=>{
      let diff=e.touches[0].clientX-startX;
      if(diff<-40){
        item.style.transform=`translateX(${diff}px)`;
      }
    });

    item.addEventListener("touchend",e=>{
      let diff=e.changedTouches[0].clientX-startX;
      if(diff<-100){
        trucks.splice(i,1);
        save(); render();
      } else {
        item.style.transform="";
      }
    });

    list.append(item);
  });

  update();
}

function addTruck(){
  const n=prompt("–ù–æ–º–µ—Ä –ë–µ–ª–ê–ó–∞")?.trim();
  if(!n || trucks.some(t=>t.n===n)) return;
  trucks.push({n,c:0});
  save(); render();
}

function shareShift(){
  const total=trucks.reduce((s,t)=>s+t.c*V,0);
  const text=trucks.map(t=>`–ë–µ–ª–ê–ó ${t.n}: ${t.c} —Ä–µ–π—Å`).join("\n") +
    `\n–ò—Ç–æ–≥–æ ${Math.round(total)} / ${plan} –º¬≥`;

  navigator.share ? navigator.share({text}) : alert(text);
}

function resetShift(){
  if(confirm("–ù–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ?")){
    trucks=[]; start=Date.now();
    save(); render();
  }
}

document.getElementById("plan").onchange=e=>{
  plan=+e.target.value||3000;
  save(); update();
};

setInterval(()=>{
  let s=Math.floor((Date.now()-start)/1000);
  let h=String(Math.floor(s/3600)).padStart(2,"0");
  let m=String(Math.floor((s%3600)/60)).padStart(2,"0");
  let sec=String(s%60).padStart(2,"0");
  document.getElementById("timer").textContent=`–°–º–µ–Ω–∞: ${h}:${m}:${sec}`;
},1000);

render();
</script>

</body>
</html>
