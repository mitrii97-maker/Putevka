<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–ö—Ä–µ—Å—Ç–∏–∫–∏-–Ω–æ–ª–∏–∫–∏ –¥–ª—è –Ω–∞—Å ‚ù§Ô∏è</title>
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getDatabase, ref, onValue, set, remove, runTransaction } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

    // ‚Üê‚Üê‚Üê‚Üê –í–°–¢–ê–í–¨ –°–í–û–ô –ù–û–í–´–ô –ö–û–ù–§–ò–ì –ó–î–ï–°–¨
const firebaseConfig = {
  apiKey: "AIzaSyAzGea6sRTQek_bYAOnJdvKjKxd5sRgX7E",
  authDomain: "klicker-love.firebaseapp.com",
  databaseURL: "https://klicker-love-default-rtdb.europe-west1.firebasedatabase.app",
  projectId: "klicker-love",
  storageBucket: "klicker-love.firebasestorage.app",
  messagingSenderId: "805841292732",
  appId: "1:805841292732:web:8bfbe94ddbe6ac7b472fb9",
  measurementId: "G-L1H4GM9FQ8"
};
    // ‚Üê‚Üê‚Üê‚Üê‚Üê‚Üê‚Üê‚Üê‚Üê‚Üê‚Üê‚Üê‚Üê‚Üê‚Üê‚Üê‚Üê‚Üê‚Üê‚Üê‚Üê‚Üê‚Üê‚Üê‚Üê‚Üê‚Üê‚Üê‚Üê

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    const gameRef = ref(db, "tictactoe");

    let mySymbol = null;
    const myName = prompt("–ö–∞–∫ —Ç–µ–±—è –∑–æ–≤—É—Ç? ‚ù§Ô∏è", "–ú–æ—è –ø–æ–ª–æ–≤–∏–Ω–∫–∞ ‚ù§Ô∏è") || "–ò–≥—Ä–æ–∫";

    // –°–±—Ä–æ—Å –∏–≥—Ä—ã —á–µ—Ä–µ–∑ #reset
    if (location.hash === "#reset") {
      remove(gameRef);
      location.hash = "";
      location.reload();
    }

    // –ì–ª–∞–≤–Ω—ã–π —Å–ª—É—à–∞—Ç–µ–ª—å —Å–æ—Å—Ç–æ—è–Ω–∏—è –∏–≥—Ä—ã
    onValue(gameRef, (snap) => {
      const data = snap.val();

      if (!data || !data.board) {
        // –ù–æ–≤–∞—è –∏–≥—Ä–∞ ‚Äî –ø–µ—Ä–≤—ã–π –∏–≥—Ä–æ–∫ —Å–æ–∑–¥–∞—ë—Ç –¥–æ—Å–∫—É
        document.getElementById("status").textContent = "–û–∂–∏–¥–∞–Ω–∏–µ –≤—Ç–æ—Ä–æ–≥–æ –∏–≥—Ä–æ–∫–∞...";
        document.getElementById("board").style.display = "none";
        return;
      }

      document.getElementById("board").style.display = "grid";

      // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Å–∏–º–≤–æ–ª –∏–≥—Ä–æ–∫–∞
      if (!mySymbol) {
        mySymbol = data.xPlayer ? "O" : "X";
        alert(`–ü—Ä–∏–≤–µ—Ç, ${myName}! –¢—ã –∏–≥—Ä–∞–µ—à—å –∑–∞ ${mySymbol === "X" ? "–∫—Ä–µ—Å—Ç–∏–∫–∏ ‚úï" : "–Ω–æ–ª–∏–∫–∏ ‚óØ"}`);
        // –°–æ—Ö—Ä–∞–Ω—è–µ–º, –∫—Ç–æ X, —á—Ç–æ–±—ã –≤—Ç–æ—Ä–æ–π —Ç–æ—á–Ω–æ –ø–æ–ª—É—á–∏–ª O
        if (mySymbol === "X") {
          set(ref(db, "tictactoe/xPlayer"), true);
        }
      }

      renderBoard(data.board);
      updateStatus(data);
    });

    function makeMove(i) {
      if (mySymbol !== currentTurn()) return;
      if (winner) return;

      runTransaction(gameRef, (current) => {
        if (!current || current.board[i]) return current; // —É–∂–µ –∑–∞–Ω—è—Ç–æ –∏–ª–∏ –Ω–µ—Ç –∏–≥—Ä—ã
        const newBoard = [...current.board];
        newBoard[i] = mySymbol;
        const win = checkWin(newBoard);
        return {
          board: newBoard,
          turn: mySymbol === "X" ? "O" : "X",
          xPlayer: true,
          winner: win.winner || (win.draw ? "draw" : null)
        };
      });
    }

    function currentTurn() {
      // –ø—Ä–æ—Å—Ç–∞—è –ª–æ–≥–∏–∫–∞: –ø–µ—Ä–≤—ã–π –∑–∞—à–µ–¥—à–∏–π ‚Äî X, –≤—Ç–æ—Ä–æ–π ‚Äî O
      const snap = gameRef; // –Ω–µ –≤–∞–∂–Ω–æ, –ø—Ä–æ—Å—Ç–æ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –º–æ–π —Å–∏–º–≤–æ–ª –∏–ª–∏ –∂–¥—ë–º
      return mySymbol;
    }

    function renderBoard(board) {
      board.forEach((cell, i) => {
        const el = document.getElementById(`c${i}`);
        el.innerHTML = cell === "X" ? "‚úï" : cell === "O" ? "‚óØ" : "";
        el.className = cell ? "cell filled" : "cell";
      });
    }

    let winner = null;
    function updateStatus(data) {
      if (data.winner === "draw") {
        document.getElementById("status").textContent = "ü§ù –ù–∏—á—å—è! –í—ã –∏–¥–µ–∞–ª—å–Ω–∞—è –ø–∞—Ä–∞ ‚ù§Ô∏è";
        winner = "draw";
      } else if (data.winner) {
        const txt = data.winner === mySymbol ? "üéâ –¢—ã –≤—ã–∏–≥—Ä–∞–ª(–∞)!" : "ü•π –ü—Ä–æ—Ç–∏–≤–Ω–∏–∫ –≤—ã–∏–≥—Ä–∞–ª...";
        document.getElementById("status").textContent = `${txt} ${data.winner === "X" ? "‚úï" : "‚óØ"} –ø–æ–±–µ–¥–∏–ª(–∞)!`;
        winner = data.winner;
      } else {
        const turnSymbol = data.turn === "X" ? "‚úï" : "‚óØ";
        const txt = data.turn === mySymbol ? "–¢–≤–æ–π —Ö–æ–¥!" : "–•–æ–¥ –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–∞";
        document.getElementById("status").textContent = `${txt} (${turnSymbol})`;
      }
    }

    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–±–µ–¥—ã
    function checkWin(board) {
      const lines = [
        [0,1,2],[3,4,5],[6,7,8],
        [0,3,6],[1,4,7],[2,5,8],
        [0,4,8],[2,4,6]
      ];
      for (const line of lines) {
        if (board[line[0]] && board[line[0]] === board[line[1]] && board[line[0]] === board[line[2]]) {
          return { winner: board[line[0]] };
        }
      }
      if (board.every(c => c)) return { draw: true };
      return {};
    }

    // –ö–ª–∏–∫ –ø–æ –∫–ª–µ—Ç–∫–∞–º
    document.querySelectorAll(".cell").forEach((cell, i) => {
      cell.onclick = () => makeMove(i);
    });

    // –ö–Ω–æ–ø–∫–∞ –Ω–æ–≤–æ–π –∏–≥—Ä—ã
    document.getElementById("reset").onclick = () => {
      remove(gameRef);
      location.reload();
    };
  </script>

  <style>
    body{margin:0;min-height:100vh;background:linear-gradient(135deg,#667eea,#764ba2);font-family:-apple-system,system-ui,sans-serif;color:#fff;display:flex;align-items:center;justify-content:center;overflow:hidden}
    .container{width:92vw;max-width:420px;background:rgba(255,255,255,0.15);backdrop-filter:blur(20px);-webkit-backdrop-filter:blur(20px);border-radius:32px;border:1px solid rgba(255,255,255,0.2);box-shadow:0 25px 50px rgba(0,0,0,0.3);padding:30px 20px;text-align:center;position:relative;overflow:hidden}
    h1{font-size:36px;margin:0 0 10px;background:linear-gradient(45deg,#ff9a9e,#fad0c4);-webkit-background-clip:text;-webkit-text-fill-color:transparent}
    #board{display:none;grid-template-columns:repeat(3,1fr);gap:14px;margin:40px auto;width:fit-content}
    .cell{width:96px;height:96px;background:rgba(255,255,255,0.2);border-radius:26px;font-size:64px;display:flex;align-items:center;justify-content:center;cursor:pointer;transition:all .3s;backdrop-filter:blur(10px);user-select:none}
    .cell:hover{background:rgba(255,255,255,0.35);transform:scale(1.08)}
    .filled{cursor:default;transform:scale(1)}
    #status{font-size:24px;margin:20px 0;font-weight:600;text-shadow:0 2px 10px rgba(0,0,0,0.3)}
    button{background:rgba(255,255,255,0.25);border:none;border-radius:20px;padding:14px 32px;color:#fff;font-size:18px;margin-top:20px;cursor:pointer;transition:.3s}
    button:hover{background:rgba(255,255,255,0.4);transform:translateY(-2px)}
    .heart{color:#ff6b9d;animation:p 2s infinite}
    @keyframes p{0%,100%{transform:scale(1)}50%{transform:scale(1.3)}}
  </style>
</head>
<body>
  <div class="container">
    <h1>–ö—Ä–µ—Å—Ç–∏–∫–∏-–Ω–æ–ª–∏–∫–∏ <span class="heart">‚ù§Ô∏è</span></h1>
    <div id="board">
      <div class="cell" id="c0"></div>
      <div class="cell" id="c1"></div>
      <div class="cell" id="c2"></div>
      <div class="cell" id="c3"></div>
      <div class="cell" id="c4"></div>
      <div class="cell" id="c5"></div>
      <div class="cell" id="c6"></div>
      <div class="cell" id="c7"></div>
      <div class="cell" id="c8"></div>
    </div>
    <div id="status">–û–∂–∏–¥–∞–Ω–∏–µ –≤—Ç–æ—Ä–æ–≥–æ –∏–≥—Ä–æ–∫–∞...</div>
    <button id="reset">–ù–æ–≤–∞—è –∏–≥—Ä–∞</button>
    <p style="margin-top:30px;font-size:14px;opacity:0.8">–°–±—Ä–æ—Å: –¥–æ–±–∞–≤–∏—Ç—å #reset –≤ —Å—Å—ã–ª–∫—É</p>
  </div>
</body>
</html>
