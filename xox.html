<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<title>Точковка</title>

<style>
/* ============================= */
/*         GLOBAL THEME          */
/* ============================= */

:root {
  --glass-bg: rgba(255,255,255,0.10);
  --glass-bg2: rgba(255,255,255,0.16);
  --border: rgba(255,255,255,0.22);
  --accent: rgba(255,255,255,0.65);
  --soft-text: rgba(255,255,255,0.7);
}

/* Переливающийся фон iOS 26 Deep Space */
body {
  margin:0;
  height:100dvh;
  overflow:hidden;
  background: radial-gradient(circle at 20% 20%, #1b2b68, #05070a 60%),
              radial-gradient(circle at 80% 80%, #0d1f44, transparent 70%),
              linear-gradient(130deg, #0b1d3d, #000);
  background-blend-mode: screen;
  font-family:-apple-system, system-ui, sans-serif;
  color:white;
  display:flex;
  flex-direction:column;
}

/* ============================= */
/*            HEADER             */
/* ============================= */

header {
  text-align:center;
  padding:60px 20px 20px;
  font-size:40px;
  font-weight:900;
  background:linear-gradient(90deg, #7faaff, #a9e4ff);
  -webkit-background-clip:text;
  -webkit-text-fill-color:transparent;
  text-shadow:0 0 30px rgba(150,200,255,0.4);
}

/* ============================= */
/*          PLAN PANEL           */
/* ============================= */

.plan {
  margin:0 16px 18px;
  padding:22px;
  background:var(--glass-bg);
  border-radius:26px;
  border:1px solid var(--border);
  backdrop-filter:blur(30px);
  box-shadow:0 0 50px rgba(255,255,255,0.05);
}

#plan {
  width:100%;
  padding:12px;
  font-size:42px;
  font-weight:800;
  text-align:center;
  background:var(--glass-bg2);
  border-radius:20px;
  border:1px solid var(--border);
  color:white;
}

/* Progress */
.pr {
  height:16px;
  background:rgba(255,255,255,0.15);
  border-radius:8px;
  overflow:hidden;
  margin:18px 0;
}

.fill {
  height:100%;
  width:0%;
  background:linear-gradient(90deg, #7ebeff, #b7f6ff);
  transition:width .6s;
}

.fill.over {
  background:linear-gradient(90deg, #b1ffb1, #ffe29e);
}

.done {
  text-align:center;
  font-size:32px;
  font-weight:800;
  margin-top:4px;
}

.left {
  text-align:center;
  font-size:22px;
  margin-top:6px;
  color:#dedede;
}

/* ============================= */
/*          TRUCK LIST           */
/* ============================= */

.list {
  flex:1;
  overflow-y:auto;
  padding:0 16px 120px;
  -webkit-overflow-scrolling:touch;
}

.t {
  display:flex;
  align-items:center;
  padding:20px;
  background:var(--glass-bg2);
  border-radius:26px;
  border:1px solid var(--border);
  backdrop-filter:blur(26px);
  margin-bottom:16px;
  box-shadow:0 0 50px rgba(255,255,255,0.06);
  transition:0.25s;
}

.n {
  width:80px;
  text-align:center;
  font-size:34px;
  font-weight:900;
}

.chk {
  width:30px;
  height:30px;
  margin-right:14px;
}

.b {
  width:60px;
  height:60px;
  border-radius:30px;
  border:none;
  font-size:36px;
  background:var(--glass-bg);
  color:white;
  margin:0 10px;
  backdrop-filter:blur(20px);
  border:1px solid var(--border);
}

.b:active { transform:scale(0.9); }

.b.m { color:#ffb3b3; }

.c {
  font-size:46px;
  min-width:110px;
  text-align:center;
  font-weight:900;
}

.v {
  margin-left:auto;
  padding:8px 16px;
  background:var(--glass-bg);
  border-radius:16px;
  border:1px solid var(--border);
  backdrop-filter:blur(20px);
  font-size:22px;
}

/* ============================= */
/*       FLOATING MENU BTN       */
/* ============================= */

.fab {
  position:fixed;
  bottom:max(30px, env(safe-area-inset-bottom));
  left:50%;
  transform:translateX(-50%);
  width:70px;
  height:70px;
  border-radius:35px;
  border:1px solid var(--border);
  background:var(--glass-bg2);
  color:white;
  font-size:32px;
  backdrop-filter:blur(25px);
  box-shadow:0 0 25px rgba(255,255,255,0.07);
  z-index:50;
}

/* ============================= */
/*           BOTTOM SHEET        */
/* ============================= */

.sh {
  position:fixed;
  left:0; right:0;
  bottom:-400px;
  padding:24px;
  padding-bottom:max(40px, env(safe-area-inset-bottom));
  background:rgba(20,25,40,0.9);
  backdrop-filter:blur(40px);
  border-radius:30px 30px 0 0;
  border-top:1px solid var(--border);
  box-shadow:0 -10px 40px rgba(0,0,0,0.4);
  transition:bottom .35s cubic-bezier(0.16,1,0.3,1);
  z-index:200;
}

.sh.open { bottom:0; }

.h {
  width:50px;
  height:6px;
  background:rgba(255,255,255,0.3);
  border-radius:3px;
  margin:0 auto 20px;
}

/* Buttons inside sheet */
.sh button {
  width:100%;
  padding:20px;
  border-radius:24px;
  border:1px solid var(--border);
  background:var(--glass-bg2);
  backdrop-filter:blur(26px);
  font-size:22px;
  font-weight:700;
  color:white;
  margin-bottom:18px;
}
</style>
</head>

<body>

<header>Точковка</header>

<div class="plan">
  <input id="plan" type="number" value="3000">
  <div class="pr"><div class="fill" id="f"></div></div>
  <div class="done" id="done">0 м³</div>
  <div class="left" id="left">Осталось: 3000 м³</div>
</div>

<div class="list" id="list"></div>

<!-- Floating button -->
<button class="fab" onclick="s.classList.toggle('open')">⋯</button>

<!-- Bottom sheet menu -->
<div class="sh" id="s">
  <div class="h"></div>
  <button onclick="add();s.classList.remove('open')">Добавить БелАЗ</button>
  <button onclick="wa();s.classList.remove('open')">Отправить диспетчеру</button>
  <button onclick="res();s.classList.remove('open')">Сбросить смену</button>
</div>

<script>
let trucks = JSON.parse(localStorage.getItem('toch2025_final')) || [];
let target = +localStorage.getItem('target2025') || 3000;

document.getElementById('plan').value = target;

trucks = trucks.map(x => ({
  n: x.n || "??",
  c: x.c || 0,
  v: x.v || 37.8,
  on: x.on !== false
}));

function save(){
  localStorage.setItem('toch2025_final', JSON.stringify(trucks));
  localStorage.setItem('target2025', target);
}

function update(){
  const total = trucks.reduce((s,x)=>s + (x.on ? x.c*x.v : 0), 0);
  const left = Math.max(0, target - total);

  document.getElementById('f').style.width =
    Math.min((total/target)*100, 120) + '%';

  document.getElementById('done').textContent =
    Math.round(total).toLocaleString() + " м³";

  document.getElementById('left').textContent =
    left === 0 ? "НОРМА ВЫПОЛНЕНА" :
    `Осталось: ${Math.round(left).toLocaleString()} м³`;
}

function render(){
  list.innerHTML = trucks.map((x,i)=>`
    <div class="t">
      <input type="checkbox" class="chk" ${x.on?"checked":""} onchange="tog(${i})">
      <div class="n">${x.n}</div>
      <button class="b m" onclick="event.stopPropagation();ch(${i},-1)">–</button>
      <div class="c" onclick="event.stopPropagation();ch(${i},5)">${x.c}</div>
      <button class="b" onclick="event.stopPropagation();ch(${i},1)">+</button>
      <div class="v" onclick="event.stopPropagation();cv(${i})">${x.v} м³</div>
    </div>
  `).join('');

  update();
}

window.tog = i => {
  trucks[i].on = !trucks[i].on;
  save(); render();
};

window.ch = (i,d) => {
  trucks[i].c = Math.max(0, trucks[i].c + d);
  save(); render();
  navigator.vibrate?.(30);
};

window.cv = i => {
  let v = prompt("Кубатура", trucks[i].v);
  if(v && !isNaN(v)){
    trucks[i].v = +v;
    save(); render();
  }
};

window.add = () => {
  let n = prompt("Номер БелАЗа")?.trim().toUpperCase();
  if(!n || trucks.some(x=>x.n===n)) return;
  let v = prompt("Кубатура", 37.8) || 37.8;
  trucks.push({ n, c:0, v:+v, on:true });
  save(); render();
};

window.wa = () => {
  const txt = trucks
    .filter(x=>x.on && x.c>0)
    .map(x => `${x.n} — ${x.c}`)
    .join('\n') || "—";

  location.href = "whatsapp://send?text=" + encodeURIComponent(txt);
};

window.res = () => {
  if(confirm("Сбросить смену?")){
    trucks = [];
    save(); render();
  }
};

document.getElementById('plan').onchange = e => {
  target = +e.target.value || 3000;
  save(); update();
};

render();
</script>

</body>
</html>