<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–ö—Ä–µ—Å—Ç–∏–∫–∏-–Ω–æ–ª–∏–∫–∏ –¥–ª—è –Ω–∞—Å ‚ù§Ô∏è</title>
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getDatabase, ref, onValue, runTransaction, remove } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyAzGea6sRTQek_bYAOnJdvKjKxd5sRgX7E",
      authDomain: "klicker-love.firebaseapp.com",
      databaseURL: "https://klicker-love-default-rtdb.europe-west1.firebasedatabase.app",
      projectId: "klicker-love",
      storageBucket: "klicker-love.firebasestorage.app",
      messagingSenderId: "805841292732",
      appId: "1:805841292732:web:fa800b89308379ba472fb9",
      measurementId: "G-5WDF36N6D0"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    const gameRef = ref(db, "xo_love_2025");

    let mySymbol = null;

    if (location.hash === "#reset") {
      remove(gameRef);
      location.hash = "";
      location.reload();
    }

    onValue(gameRef, (snap) => {
      let data = snap.val() || { board: Array(9).fill(null), turn: "X" };

      if (!mySymbol) {
        mySymbol = data.turn === "X" ? "X" : "O";
        alert(`–¢—ã ${mySymbol === "X" ? "–∫—Ä–µ—Å—Ç–∏–∫–∏ ‚úï" : "–Ω–æ–ª–∏–∫–∏ ‚óØ"}`);
      }

      document.getElementById("board").style.display = "grid";
      render(data.board);
      updateStatus(data);
    });

    document.querySelectorAll(".cell").forEach((cell, i) => {
      cell.onclick = () => {
        runTransaction(gameRef, (current) => {
          if (!current || current.board[i] || current.turn !== mySymbol || current.winner) return current;
          const newBoard = [...current.board];
          newBoard[i] = mySymbol;
          const win = checkWin(newBoard);
          return {
            board: newBoard,
            turn: mySymbol === "X" ? "O" : "X",
            winner: win.winner || (win.draw ? "draw" : null)
          };
        });
      };
    });

    function render(board) {
      board.forEach((val, i) => {
        const cell = document.getElementById("c" + i);
        cell.textContent = val === "X" ? "‚úï" : val === "O" ? "‚óØ" : "";
      });
    }

    function updateStatus(data) {
      const win = checkWin(data.board || []);
      const s = document.getElementById("status");
      if (win.winner) s.textContent = win.winner === mySymbol ? "üéâ –¢–´ –í–´–ò–ì–†–ê–õ(–ê)!!!" : "‚ù§Ô∏è –í—Å—ë —Ä–∞–≤–Ω–æ –ª—é–±–ª—é";
      else if (win.draw) s.textContent = "ü§ù –ù–∏—á—å—è ‚Äî –≤—ã –ª—É—á—à–∏–µ!";
      else s.textContent = data.turn === mySymbol ? "üöÄ –¢–í–û–ô –•–û–î!" : "‚è≥ –ñ–¥—ë–º —Ö–æ–¥ –ª—é–±–∏–º–æ–≥–æ(–æ–π)...";
    }

    function checkWin(b) {
      const lines = [[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]];
      for (let l of lines) if (b[l[0]] && b[l[0]] === b[l[1]] && b[l[0]] === b[l[2]]) return { winner: b[l[0]] };
      if (b.every(c => c)) return { draw: true };
      return {};
    }

    document.getElementById("reset").onclick = () => { remove(gameRef); location.reload(); };
  </script>
  <style>
    body{margin:0;height:100dvh;background:#000;color:#fff;font-family:-apple-system,system-ui;display:flex;align-items:center;justify-content:center}
    .container{width:92vw;max-width:400px;background:rgba(20,20,35,0.9);backdrop-filter:blur(40px);border-radius:40px;border:1px solid rgba(255,100,200,0.3);box-shadow:0 30px 80px rgba(0,0,0,0.8);padding:40px 20px;text-align:center}
    h1{font-size:36px;background:linear-gradient(135deg,#ff69b4,#ba55d3);-webkit-background-clip:text;-webkit-text-fill-color:transparent;margin-bottom:20px}
    #board{display:none;grid-template-columns:repeat(3,1fr);gap:16px;margin:40px 0}
    .cell{aspect-ratio:1;background:rgba(255,255,255,0.08);border-radius:30px;font-size:70px;display:flex;align-items:center;justify-content:center;cursor:pointer;transition:.3s}
    .cell:hover{background:rgba(255,255,255,0.2);transform:scale(1.05)}
    #status{font-size:26px;font-weight:600;margin:20px 0;min-height:60px}
    #reset{background:linear-gradient(135deg,#ff69b4,#ba55d3);border:none;border-radius:30px;padding:16px 40px;color:#fff;font-size:19px;cursor:pointer}
  </style>
</head>
<body>
  <div class="container">
    <h1>–ö—Ä–µ—Å—Ç–∏–∫–∏-–Ω–æ–ª–∏–∫–∏ ‚ù§Ô∏è</h1>
    <div id="board">
      <div class="cell" id="c0"></div><div class="cell" id="c1"></div><div class="cell" id="c2"></div>
      <div class="cell" id="c3"></div><div class="cell" id="c4"></div><div class="cell" id="c5"></div>
      <div class="cell" id="c6"></div><div class="cell" id="c7"></div><div class="cell" id="c8"></div>
    </div>
    <div id="status">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
    <button id="reset">–ù–æ–≤–∞—è –∏–≥—Ä–∞</button>
  </div>
</body>
</html>
