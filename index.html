<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<title>–≠–∫—Å–∫–∞–≤–∞—Ç–æ—Ä</title>
<style>
  :root {
    --accent: #007aff;
    --green: #30d158;
    --red: #ff3b30;
    --orange: #ff9f0a;
  }
  @media (prefers-color-scheme: light) {
    :root {
      --bg: linear-gradient(135deg, #f0f0f8, #d0e0ff);
      --glass: rgba(255,255,255,0.65);
      --glass-strong: rgba(255,255,255,0.85);
      --border: rgba(0,0,0,0.08);
      --text: #000;
      --text-dim: rgba(0,0,0,0.6);
    }
  }
  @media (prefers-color-scheme: dark) {
    :root {
      --bg: linear-gradient(135deg, #000000, #0a001f);
      --glass: rgba(20,20,40,0.5);
      --glass-strong: rgba(30,30,60,0.7);
      --border: rgba(255,255,255,0.1);
      --text: #fff;
      --text-dim: rgba(255,255,255,0.65);
    }
  }

  * { margin:0; padding:0; box-sizing:border-box; }
  html, body {
    height: 100dvh;
    overflow: hidden;
    font-family: -apple-system, BlinkMacSystemFont, "SF Pro Display", sans-serif;
    background: var(--bg);
    color: var(--text);
    background-attachment: fixed;
  }
  body { display:flex; flex-direction:column; }

  /* –ñ–∏–≤–æ–π —Ñ–æ–Ω –∫–∞–∫ –æ–±–æ–∏ Apple */
  .wallpaper {
    position: fixed;
    inset: 0;
    background: var(--bg);
    background-size: 200% 200%;
    animation: slowmove 30s ease infinite;
    z-index: -3;
  }
  .blur {
    position: fixed;
    inset: 0;
    backdrop-filter: blur(80px);
    -webkit-backdrop-filter: blur(80px);
    z-index: -2;
  }

  @keyframes slowmove {
    0% { background-position: 0% 0%; }
    50% { background-position: 100% 100%; }
    100% { background-position: 0% 0%; }
  }

  header {
    text-align: center;
    padding: 60px 20px 20px;
    font-size: 42px;
    font-weight: 900;
    letter-spacing: -1.2px;
    background: linear-gradient(90deg, #007aff, #30d158);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
  }

  .glass {
    margin: 20px;
    padding: 24px;
    background: var(--glass);
    border-radius: 28px;
    border: 1px solid var(--border);
    backdrop-filter: blur(30px);
    -webkit-backdrop-filter: blur(30px);
    box-shadow: 0 20px 40px rgba(0,0,0,0.25);
  }

  #plan {
    width: 100%;
    padding: 16px;
    font-size: 48px;
    font-weight: 800;
    text-align: center;
    background: var(--glass-strong);
    border: 1px solid var(--border);
    border-radius: 20px;
    color: var(--text);
    margin-bottom: 20px;
  }

  .progress {
    height: 18px;
    background: rgba(255,255,255,0.15);
    border-radius: 9px;
    overflow: hidden;
    margin: 20px 0;
  }
  .fill {
    height: 100%;
    width: 0%;
    background: linear-gradient(90deg, var(--accent), var(--green));
    transition: width 0.7s cubic-bezier(0.16,1,0.3,1);
    box-shadow: 0 0 20px rgba(0,122,255,0.5);
  }
  .fill.over { background: linear-gradient(90deg, var(--green), var(--orange)); }

  .stats { text-align:center; font-size:34px; font-weight:800; }
  .over-text { font-size:38px; color:var(--orange); margin-top:8px; }

  .timer {
    text-align:center;
    font-size:26px;
    font-weight:600;
    color:var(--text-dim);
    margin: -10px 0 20px;
  }

  .trucks {
    flex:1;
    overflow-y:auto;
    padding: 0 20px 140px;
    -webkit-overflow-scrolling: touch;
  }
  .truck {
    padding:22px;
    background: var(--glass-strong);
    border-radius: 24px;
    margin-bottom:14px;
    border:1px solid var(--border);
    display:flex;
    align-items:center;
    animation: appear 0.4s ease backwards;
  }
  @keyframes appear { from { opacity:0; transform:translateY(30px); } }

  .num { font-size:38px; font-weight:900; width:90px; text-align:center; }
  .count { font-size:64px; font-weight:900; min-width:130px; text-align:center; }
  .vol { margin-left:auto; font-size:28px; font-weight:600; color:var(--text-dim); }

  .btn {
    width:80px; height:80px; border-radius:40px; border:none;
    font-size:48px; font-weight:bold; color:white;
    box-shadow:0 10px 30px rgba(0,0,0,0.4);
    transition:transform 0.2s;
  }
  .btn:active { transform:scale(0.9); }
  .plus { background:var(--accent); }
  .minus { background:var(--red); }

  .bottom {
    position:fixed;
    bottom:0; left:0; right:0;
    padding:20px;
    padding-bottom:max(34px, env(safe-area-inset-bottom));
    background: var(--glass);
    backdrop-filter: blur(40px);
    -webkit-backdrop-filter: blur(40px);
    border-top:1px solid var(--border);
    display:grid;
    grid-template-columns: 1fr 1fr 1fr;
    gap:14px;
  }
  .fab {
    padding:18px;
    font-size:19px;
    font-weight:700;
    border-radius:20px;
    border:none;
    color:white;
    box-shadow:0 8px 25px rgba(0,0,0,0.3);
  }
  .fab-green { background:var(--green); }
  .fab-blue { background:var(--accent); }
  .fab-orange { background:var(--orange); }
</style>
</head>
<body>

<div class="wallpaper"></div>
<div class="blur"></div>

<header>–≠–∫—Å–∫–∞–≤–∞—Ç–æ—Ä</header>

<div class="glass">
  <div style="text-align:center; font-size:18px; color:var(--text-dim);">–ù–∞—Ä—è–¥ –Ω–∞ —Å–º–µ–Ω—É, –º¬≥</div>
  <input id="plan" type="number" value="3000">
  <div class="progress"><div class="fill" id="fill"></div></div>
  <div class="stats" id="stats">0 / 3000 –º¬≥</div>
  <div class="over-text" id="over" style="display:none">+0 –º¬≥ üî•</div>
</div>

<div class="timer" id="timer">–°–º–µ–Ω–∞: 00:00:00</div>

<div class="trucks" id="list"></div>

<div class="bottom">
  <button class="fab fab-blue" onclick="addTruck()">+ –ë–µ–ª–ê–ó</button>
  <button class="fab fab-green" onclick="shareShift()">–ü–æ–¥–µ–ª–∏—Ç—å—Å—è</button>
  <button class="fab fab-orange" onclick="resetShift()">–°–±—Ä–æ—Å</button>
</div>

<script>
  const V = 37.8;
  let trucks = JSON.parse(localStorage.getItem('exc_apple')) || [];
  let target = +localStorage.getItem('exc_plan') || 3000;
  let start = localStorage.getItem('exc_day') === new Date().toDateString() ?
              +localStorage.getItem('exc_start') : Date.now();

  if (!localStorage.getItem('exc_day')) {
    localStorage.setItem('exc_day', new Date().toDateString());
    localStorage.setItem('exc_start', Date.now());
    start = Date.now();
  }

  document.getElementById('plan').value = target;

  function save() {
    localStorage.setItem('exc_apple', JSON.stringify(trucks));
    localStorage.setItem('exc_plan', target);
    localStorage.setItem('exc_start', start);
    localStorage.setItem('exc_day', new Date().toDateString());
  }

  function update() {
    const total = trucks.reduce((s,t)=>s + t.c*V, 0);
    const perc = Math.min(total/target*100, 200);
    document.getElementById('fill').style.width = perc + '%';
    document.getElementById('stats').textContent = `${Math.round(total).toLocaleString()} / ${target.toLocaleString()} –º¬≥`;
    const over = total > target;
    document.getElementById('over').style.display = over ? 'block' : 'none';
    if (over) document.getElementById('over').textContent = `+${Math.round(total-target).toLocaleString()} –º¬≥ üî•`;
    document.getElementById('fill').classList.toggle('over', over);
  }

  function render() {
    const list = document.getElementById('list');
    list.innerHTML = trucks.map((t,i)=>`
      <div class="truck" data-i="${i}" onpointerdown="swipeStart(event,this)">
        <div style="position:absolute; left:0; top:0; bottom:0; width:100px; background:var(--red); color:white; display:flex; align-items:center; justify-content:center; font-size:28px; transform:translateX(-100%); transition:0.3s;">
          –£–¥–∞–ª–∏—Ç—å
        </div>
        <div style="width:100%; display:flex; align-items:center;">
          <div class="num">${t.n}</div>
          <button class="btn minus" onclick="event.stopPropagation(); ch(${i},-1)">‚Äì</button>
          <div class="count" onclick="event.stopPropagation(); ch(${i},5)" style="cursor:pointer">${t.c}</div>
          <button class="btn plus" onclick="event.stopPropagation(); ch(${i},1)">+</button>
          <div class="vol">${(t.c*V).toFixed(1)} –º¬≥</div>
        </div>
      </div>
    `).join('');
    update();
  }

  window.ch = (i,d) => {
    trucks[i].c = Math.max(0, trucks[i].c + d);
    save(); render();
    navigator.vibrate?.(30);
  }

  let swipeEl = null;
  window.swipeStart = (e,el) => {
    if (e.pointerType==='mouse') return;
    let startX = e.touches[0].clientX;
    const move = e=> {
      let diff = e.touches[0].clientX - startX;
      if (diff < -40) el.style.transform = `translateX(${diff}px)`;
    };
    const end = e=> {
      if (e.changedTouches[0].clientX - startX < -100) {
        trucks.splice(el.dataset.i,1);
        save(); render();
      } else {
        el.style.transform = '';
      }
      document.removeEventListener('touchmove',move);
      document.removeEventListener('touchend',end);
    };
    document.addEventListener('touchmove',move);
    document.addEventListener('touchend',end);
  }

  window.addTruck = () => {
    const n = prompt('–ù–æ–º–µ—Ä –ë–µ–ª–ê–ó–∞')?.trim().toUpperCase();
    if (!n || trucks.some(t=>t.n===n)) return;
    trucks.push({n, c:0});
    save(); render();
  }

  window.shareShift = () => {
    const total = trucks.reduce((s,t)=>s+t.c*V,0);
    const text = `–≠–∫—Å–∫–∞–≤–∞—Ç–æ—Ä ‚Ä¢ –°–º–µ–Ω–∞\n\n` +
      trucks.filter(t=>t.c>0).map(t=>`–ë–µ–ª–ê–ó ${t.n} ‚Äî ${t.c} —Ä–µ–π—Å${t.c>1?'–∞':''}`).join('\n') ||
      '–†–µ–π—Å–æ–≤ –ø–æ–∫–∞ –Ω–µ—Ç\n' +
      `\n–ò—Ç–æ–≥–æ: ${Math.round(total)} –º¬≥ –∏–∑ ${target}\n–ü–µ—Ä–µ–≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ: ${Math.round(total-target)} –º¬≥ üî•\n–í—Ä–µ–º—è —Å–º–µ–Ω—ã: ${document.getElementById('timer').textContent}`;
    navigator.share ? navigator.share({text}) : navigator.clipboard.writeText(text) && alert('–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ –≤ –±—É—Ñ–µ—Ä');
  }

  window.resetShift = () => confirm('–ù–∞—á–∞—Ç—å –Ω–æ–≤—É—é —Å–º–µ–Ω—É?') && (trucks=[], start=Date.now(), save(), render());

  document.getElementById('plan').onchange = e => { target = +e.target.value || 3000; save(); update(); };

  // –¢–∞–π–º–µ—Ä
  setInterval(() => {
    let s = Math.floor((Date.now() - start)/1000);
    let h = String(Math.floor(s/3600)).padStart(2,'0');
    let m = String(Math.floor(s%3600/60)).padStart(2,'0');
    let sec = String(s%60).padStart(2,'0');
    document.getElementById('timer').textContent = `–°–º–µ–Ω–∞: ${h}:${m}:${sec}`;
  }, 1000);

  render();
</script>
</body>
</html>
