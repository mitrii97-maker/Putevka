<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–ö—Ä–µ—Å—Ç–∏–∫–∏-–Ω–æ–ª–∏–∫–∏ –¥–ª—è –Ω–∞—Å ‚ù§Ô∏è</title>
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getDatabase, ref, onValue, set, remove, runTransaction } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

    // ‚Üê‚Üê‚Üê‚Üê‚Üê‚Üê‚Üê‚Üê‚Üê‚Üê‚Üê‚Üê‚Üê‚Üê‚Üê‚Üê‚Üê‚Üê‚Üê‚Üê‚Üê‚Üê‚Üê‚Üê‚Üê‚Üê‚Üê
    // –í–°–¢–ê–í–¨ –°–í–û–ô –ù–û–í–´–ô –ö–û–ù–§–ò–ì –°–Æ–î–ê
    const firebaseConfig = {
  apiKey: "AIzaSyAzGea6sRTQek_bYAOnJdvKjKxd5sRgX7E",
  authDomain: "klicker-love.firebaseapp.com",
  databaseURL: "https://klicker-love-default-rtdb.europe-west1.firebasedatabase.app",
  projectId: "klicker-love",
  storageBucket: "klicker-love.firebasestorage.app",
  messagingSenderId: "805841292732",
  appId: "1:805841292732:web:8bfbe94ddbe6ac7b472fb9",
  measurementId: "G-L1H4GM9FQ8"
};
    // ‚Üê‚Üê‚Üê‚Üê‚Üê‚Üê‚Üê‚Üê‚Üê‚Üê‚Üê‚Üê‚Üê‚Üê‚Üê‚Üê‚Üê‚Üê‚Üê‚Üê‚Üê‚Üê‚Üê‚Üê‚Üê‚Üê‚Üê

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    const gameRef = ref(db, "tictactoe_game");

    let mySymbol = null;

    const name = prompt("–ö–∞–∫ —Ç–µ–±—è –∑–æ–≤—É—Ç? ‚ù§Ô∏è", "–õ—é–±–∏–º–∞—è ‚ù§Ô∏è") || "–ò–≥—Ä–æ–∫";

    // –°–±—Ä–æ—Å —á–µ—Ä–µ–∑ #reset
    if (location.hash === "#reset") {
      remove(gameRef);
      location.hash = "";
      location.reload();
    }

    // –ì–ª–∞–≤–Ω—ã–π —Å–ª—É—à–∞—Ç–µ–ª—å
    onValue(gameRef, (snap) => {
      const data = snap.val();

      // –ï—Å–ª–∏ –∏–≥—Ä—ã –µ—â—ë –Ω–µ—Ç ‚Äî —Å–æ–∑–¥–∞—ë–º –∏ —Å—Ç–∞–Ω–æ–≤–∏–º—Å—è –∫—Ä–µ—Å—Ç–∏–∫–∞–º–∏
      if (!data) {
        set(gameRef, {
          board: Array(9).fill(null),
          turn: "X",
          status: "waiting"
        });
        mySymbol = "X";
        document.getElementById("status").textContent = "–¢—ã –∫—Ä–µ—Å—Ç–∏–∫–∏ ‚úï ¬∑ –ñ–¥—ë–º –≤—Ç–æ—Ä–æ–≥–æ –∏–≥—Ä–æ–∫–∞...";
        return;
      }

      // –ò–≥—Ä–∞ —É–∂–µ –µ—Å—Ç—å
      document.getElementById("board").style.display = "grid";

      // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Å–∏–º–≤–æ–ª
      if (!mySymbol) {
        mySymbol = data.turn === "X" && data.status === "waiting" ? "O" : "X"; // –µ—Å–ª–∏ –∫—Ç–æ-—Ç–æ —É–∂–µ X –∏ –∂–¥—ë—Ç ‚Äî —Ç—ã O
        if (mySymbol === "O") {
          set(gameRef, { ...data, status: "playing" }); // –∏–≥—Ä–∞ –Ω–∞—á–∞–ª–∞—Å—å
        }
        alert(`${name}, —Ç—ã ${mySymbol === "X" ? "–∫—Ä–µ—Å—Ç–∏–∫–∏ ‚úï" : "–Ω–æ–ª–∏–∫–∏ ‚óØ"}`);
      }

      renderBoard(data.board);
      updateStatus(data);
    });

    function makeMove(i) {
      runTransaction(gameRef, (current) => {
        if (!current || current.board[i] || current.winner) return current;
        if (mySymbol !== current.turn) return current;

        const newBoard = [...current.board];
        newBoard[i] = mySymbol;

        const win = checkWin(newBoard);
        return {
          board: newBoard,
          turn: mySymbol === "X" ? "O" : "X",
          status: "playing",
          winner: win.winner || (win.draw ? "draw" : null)
        };
      });
    }

    function renderBoard(board) {
      board.forEach((cell, i) => {
        const el = document.getElementById(`c${i}`);
        el.innerHTML = cell === "X" ? '<div class="x">‚úï</div>' : cell === "O" ? '<div class="o">‚óØ</div>' : "";
      });
    }

    function updateStatus(data) {
      if (data.winner === "draw") {
        document.getElementById("status").textContent = "ü§ù –ù–∏—á—å—è! –í—ã –∏–¥–µ–∞–ª—å–Ω–∞—è –ø–∞—Ä–∞ ‚ù§Ô∏è";
      } else if (data.winner) {
        document.getElementById("status").textContent = data.winner === mySymbol 
          ? "üéâ –¢—ã –ü–û–ë–ï–î–ò–õ(–ê)!!! üèÜ" 
          : "ü•π –¢—ã –ø—Ä–æ–∏–≥—Ä–∞–ª(–∞)... –Ω–æ —è —Ç–µ–±—è –≤—Å—ë —Ä–∞–≤–Ω–æ –ª—é–±–ª—é ‚ù§Ô∏è";
      } else {
        const turnText = data.turn === mySymbol ? "–¢–í–û–ô –•–û–î!" : "–•–æ–¥ –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–∞";
        document.getElementById("status").textContent = `${turnText} (${data.turn === "X" ? "‚úï" : "‚óØ"})`;
      }
    }

    function checkWin(b) {
      const lines = [[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]];
      for (let l of lines) {
        if (b[l[0]] && b[l[0]] === b[l[1]] && b[l[0]] === b[l[2]]) return { winner: b[l[0]] };
      }
      if (b.every(c => c)) return { draw: true };
      return {};
    }

    // –ö–ª–∏–∫ –ø–æ –∫–ª–µ—Ç–∫–∞–º
    document.querySelectorAll(".cell").forEach((c, i) => c.onclick = () => makeMove(i));

    // –ù–æ–≤–∞—è –∏–≥—Ä–∞
    document.getElementById("reset").onclick = () => {
      remove(gameRef);
      location.reload();
    };
  </script>

  <style>
    body{margin:0;min-height:100vh;background:linear-gradient(135deg,#ff9a9e,#fad0c4);font-family:-apple-system,system-ui,sans-serif;color:#fff;display:flex;align-items:center;justify-content:center}
    .container{max-width:420px;width:92%;background:rgba(255,255,255,0.18);backdrop-filter:blur(25px);border-radius:34px;border:1px solid rgba(255,255,255,0.3);box-shadow:0 30px 60px rgba(0,0,0,0.25);padding:40px 20px;text-align:center}
    h1{font-size:38px;margin:0 0 15px;background:linear-gradient(45deg,#fff,#ff6b9d);-webkit-background-clip:text;-webkit-text-fill-color:transparent}
    #board{display:none;grid-template-columns:repeat(3,1fr);gap:16px;margin:40px auto}
    .cell{width:100px;height:100px;background:rgba(255,255,255,0.25);border-radius:28px;display:flex;align-items:center;justify-content:center;cursor:pointer;transition:.3s;font-size:70px}
    .cell:hover{background:rgba(255,255,255,0.4);transform:scale(1.07)}
    .x{color:#ff6b9d;animation:pulse 0.6s}
    .o{color:#a8e6cf;animation:pulse 0.6s}
    @keyframes pulse{0%{transform:scale(0)}50%{transform:scale(1.2)}100%{transform:scale(1)}}
    #status{font-size:26px;font-weight:600;margin:20px 0;min-height:50px}
    button{background:rgba(255,255,255,0.3);border:none;border-radius:25px;padding:16px 36px;color:#fff;font-size:19px;cursor:pointer;margin-top:20px;transition:.3s}
    button:hover{background:rgba(255,255,255,0.5);transform:translateY(-3px)}
    .heart{color:#ff6b9d;animation:beat 1.5s infinite}
    @keyframes beat{0%,100%{transform:scale(1)}50%{transform:scale(1.3)}}
  </style>
</head>
<body>
  <div class="container">
    <h1>–ö—Ä–µ—Å—Ç–∏–∫–∏-–Ω–æ–ª–∏–∫–∏ <span class="heart">‚ù§Ô∏è</span></h1>
    <div id="board">
      <div class="cell" id="c0"></div>
      <div class="cell" id="c1"></div>
      <div class="cell" id="c2"></div>
      <div class="cell" id="c3"></div>
      <div class="cell" id="c4"></div>
      <div class="cell" id="c5"></div>
      <div class="cell" id="c6"></div>
      <div class="cell" id="c7"></div>
      <div class="cell" id="c8"></div>
    </div>
    <div id="status">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
    <button id="reset">–ù–æ–≤–∞—è –∏–≥—Ä–∞</button>
    <p style="margin-top:25px;font-size:14px;opacity:0.8">–°–±—Ä–æ—Å: –¥–æ–±–∞–≤–∏—Ç—å #reset –≤ —Å—Å—ã–ª–∫—É</p>
  </div>
</body>
</html>
