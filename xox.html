<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#000000">
    <title>БелАЗ</title>
    <link rel="apple-touch-icon" sizes="180x180" href="https://img.icons8.com/fluency/180/truck.png">
    <style>
        :root {
            --red: #ff453a;
            --yellow: #ffd60a;
            --green: #1e7b3a;        /* красивый тёмно-зелёный */
            --purple: #bf5af2;
            --blur: blur(20px);
            --glass: rgba(30, 30, 36, 0.65);
            --glass-border: rgba(255, 255, 255, 0.08);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', sans-serif;
            background: url('https://i.imgur.com/8pZ3XKp.jpg') no-repeat center/cover fixed;
            color: white;
            min-height: 100vh;
            padding-bottom: 120px;
            overflow-x: hidden;
        }

        .overlay {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.55);
            backdrop-filter: var(--blur);
            -webkit-backdrop-filter: var(--blur);
            pointer-events: none;
            z-index: -1;
        }

        .glass {
            background: var(--glass);
            backdrop-filter: var(--blur);
            -webkit-backdrop-filter: var(--blur);
            border-radius: 20px;
            border: 1px solid var(--glass-border);
            box-shadow: 0 8px 32px rgba(0,0,0,0.4);
            overflow: hidden;
            margin: 0 16px 12px;
        }

        .plan {
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-weight: 700;
            font-size: 20px;
        }
        .plan input {
            background: transparent;
            border: none;
            color: white;
            font-size: 38px;
            font-weight: 800;
            width: 150px;
            text-align: right;
            outline: none;
        }

        .bar-container {
            height: 40px;                    /* тоньше */
            margin: 16px;
            border-radius: 20px;
            overflow: hidden;
            background: rgba(255,255,255,0.1);
            border: 1px solid var(--glass-border);
        }
        .bar {
            height: 100%;
            width: 0%;
            border-radius: 20px;
            transition: all 0.8s cubic-bezier(0.16, 1, 0.3, 1);
        }

        .stats {
            display: flex;
            justify-content: space-between;
            margin: 10px 20px 25px;
            font-size: 19px;
            font-weight: 600;
        }

        .cards { padding: 0 10px 20px; }
        .card {
            margin: 12px 6px;
            padding: 18px 20px;
            display: flex;
            align-items: center;
            transition: all 0.3s;
        }
        .card.excluded { opacity: 0.35; transform: scale(0.98); }

        .card-info { flex: 1; }
        .card-title { font-size: 22px; font-weight: 700; }
        .card-capacity { font-size: 15px; opacity: 0.8; }

        .counter { display: flex; align-items: center; gap: 24px; }
        .btn {
            width: 52px; height: 52px;
            border-radius: 50%; border: none;
            font-size: 32px; color: white; font-weight: bold;
            box-shadow: 0 6px 15px rgba(0,0,0,0.4);
        }
        .minus { background: var(--red); }
        .plus { background: #30d158; }

        .fab {
            position: fixed;
            bottom: 30px; left: 50%;
            transform: translateX(-50%);
            width: 72px; height: 72px;
            background: linear-gradient(135deg, #0a84ff, #007aff);
            border-radius: 50%; font-size: 38px; color: white;
            box-shadow: 0 12px 35px rgba(10,132,255,0.6);
            z-index: 10; border: none;
        }

        .menu {
            position: fixed; bottom: 0; left: 0; right: 0;
            background: var(--glass);
            backdrop-filter: var(--blur);
            -webkit-backdrop-filter: var(--blur);
            border-radius: 32px 32px 0 0;
            padding: 40px 24px 50px;
            transform: translateY(100%);
            transition: transform 0.45s cubic-bezier(0.16, 1, 0.3, 1);
            border-top: 1px solid var(--glass-border);
            box-shadow: 0 -10px 40px rgba(0,0,0,0.5);
            z-index: 100;
        }
        .menu.open { transform: translateY(0); }
        .menu button {
            width: 100%; padding: 20px; margin: 12px 0;
            border: none; border-radius: 18px;
            font-size: 19px; font-weight: 700; color: white;
            box-shadow: 0 8px 20px rgba(0,0,0,0.3);
        }
        .add    { background: linear-gradient(135deg, #0a84ff, #007aff); }
        .send   { background: linear-gradient(135deg, #30d158, #28a745); }
        .reset  { background: linear-gradient(135deg, #ff453a, #ff2d1a); }
        .close  { background: rgba(255,255,255,0.15); }
    </style>
</head>
<body>

    <div class="overlay"></div>

    <div class="glass plan">
        <span>ПЛАН</span>
        <div>
            <input type="number" id="plan" value="3000"> <span style="font-size:38px;font-weight:800">м³</span>
        </div>
    </div>

    <div class="bar-container glass">
        <div class="bar" id="bar"></div>
    </div>

    <div class="stats">
        <div>
            <div style="opacity:0.7;font-size:16px">Сделано</div>
            <div style="font-size:32px;font-weight:800" id="done">0.0 м³</div>
        </div>
        <div style="text-align:right">
            <div style="opacity:0.7;font-size:16px">Осталось / +</div>
            <div style="font-size:32px;font-weight:800" id="left">3000.0 м³</div>
        </div>
    </div>

    <div class="cards" id="cards"></div>

    <button class="fab" id="fab">+</button>

    <div class="menu glass" id="menu">
        <button class="add"    onclick="addBelaz()">Добавить БелАЗ</button>
        <button class="send"   onclick="sendReport()">Отправить диспетчеру</button>
        <button class="reset"  onclick="resetShift()">Сбросить смену</button>
        <button class="close"  onclick="closeMenu()">Закрыть</button>
    </div>

    <script>
        const capacities = [37.8, 36.0, 21.0];   // 37.8 вместо 38.7
        let belazList = JSON.parse(localStorage.getItem('belazList') || '[]');
        let plan = Math.max(parseFloat(localStorage.getItem('plan') || '3000'), 1);

        document.getElementById('plan').value = plan;

        function save() {
            localStorage.setItem('belazList', JSON.stringify(belazList));
            localStorage.setItem('plan', plan);
        }

        function calc() {
            const total = belazList.reduce((s, b) => s + b.trips * b.capacity, 0);
            const percent = total / plan;
            const over = Math.max(0, total - plan);

            document.getElementById('done').textContent = total.toFixed(1) + ' м³';
            document.getElementById('left').textContent = over > 0 ? '+' + over.toFixed(1) + ' м³' : (plan - total).toFixed(1) + ' м³';
            document.getElementById('left').style.color = over > 0 ? 'var(--purple)' : '#ff9f0a';

            const bar = document.getElementById('bar');
            bar.style.width = Math.min(percent * 100, 200) + '%';

            if (percent < 0.7)      bar.style.background = 'var(--red)';
            else if (percent < 1)   bar.style.background = 'var(--yellow)';
            else                    bar.style.background = 'var(--green)'; // тёмно-зелёный от 100% и выше
        }

        function renderCards() {
            const c = document.getElementById('cards');
            c.innerHTML = '';
            belazList.forEach((b, i) => {
                const card = document.createElement('div');
                card.className = 'card glass' + (b.exclude ? ' excluded' : '');
                card.innerHTML = `
                    <div class="card-info">
                        <div class="card-title">БелАЗ ${b.number}</div>
                        <div class="card-capacity">${b.capacity}</div>
                    </div>
                    <div class="counter">
                        <button class="btn minus" onclick="changeTrip(${i},-1)">−</button>
                        <div style="width:70px;text-align:center;font-size:36px;font-weight:800">${b.trips}</div>
                        <button class="btn plus" onclick="changeTrip(${i},1)">+</button>
                    </div>
                    <input type="checkbox" ${b.exclude?'checked':''} onchange="toggleExclude(${i})" style="transform:scale(1.8);margin-left:20px">
                `;
                c.appendChild(card);
            });
            calc();
        }

        function changeTrip(i, d) {
            if (belazList[i].trips + d >= 0) {
                belazList[i].trips += d;
                save(); renderCards();
            }
        }

        function toggleExclude(i) {
            belazList[i].exclude = !belazList[i].exclude;
            save(); renderCards();
        }

        function addBelaz() {
            const num = prompt('Номер БелАЗа:');
            if (!num) return;
            const sel = prompt('Кубатура за рейс:\n1) 37.8\n2) 36.0\n3) 21.0', '1');
            const cap = capacities[parseInt(sel)-1] || 37.8;

            belazList.push({ number: num.trim(), capacity: cap, trips: 0, exclude: false });
            save(); renderCards(); closeMenu();
        }

        function sendReport() {
            let text = `СМЕНА ${new Date().toLocaleString('ru-RU')}\nПлан: ${plan} м³\n`;
            const total = belazList.reduce((s, b) => s + b.trips * b.capacity, 0);
            text += `Выполнено: ${total.toFixed(1)} м³ (${(total/plan*100).toFixed(1)}%)\n`;
            if (total > plan) text += `Перевыполнение: +${(total-plan).toFixed(1)} м³\n\nРейсы:\n`;

            belazList.filter(b => !b.exclude && b.trips > 0).forEach(b => {
                text += `• БелАЗ ${b.number}: ${b.trips} × ${b.capacity} = ${(b.trips*b.capacity).toFixed(1)} м³\n`;
            });

            window.open(`https://api.whatsapp.com/send?text=${encodeURIComponent(text)}`, '_blank');
            closeMenu();
        }

        function resetShift() {
            if (confirm('Сбросить смену?')) {
                belazList = []; plan = 3000;
                localStorage.clear();
                document.getElementById('plan').value = 3000;
                renderCards(); closeMenu();
            }
        }

        function closeMenu() {
            document.getElementById('menu').classList.remove('open');
        }

        document.getElementById('fab').onclick = () => document.getElementById('menu').classList.add('open');
        document.getElementById('plan').oninput = e => { plan = Math.max(parseFloat(e.target.value)||3000,1); save(); calc(); };

        renderCards();
    </script>
</body>
</html>