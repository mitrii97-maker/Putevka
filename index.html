<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<title>–¢–æ—á–∫–æ–≤–∫–∞</title>
<style>
  :root {
    --bg: #000;
    --glass: rgba(255,255,255,0.08);
    --glass-strong: rgba(255,255,255,0.15);
    --border: rgba(255,255,255,0.12);
    --text: #fff;
    --text-dim: rgba(255,255,255,0.7);
    --accent: #007aff;
    --green: #30d158;
    --red: #ff3b30;
  }
  @media (prefers-color-scheme: light) {
    :root {
      --bg: #f5f5f7;
      --glass: rgba(255,255,255,0.7);
      --glass-strong: rgba(255,255,255,0.9);
      --border: rgba(0,0,0,0.1);
      --text: #000;
      --text-dim: rgba(0,0,0,0.65);
    }
  }

  * { margin:0; padding:0; box-sizing:border-box; }
  html, body {
    height: 100dvh;
    overflow: hidden;
    font-family: -apple-system, SF Pro Display, sans-serif;
    background: var(--bg);
    color: var(--text);
  }
  body { display: flex; flex-direction: column; }

  .header {
    padding: 50px 20px 20px;
    text-align: center;
    font-size: 40px;
    font-weight: 800;
    letter-spacing: -1px;
  }

  .glass {
    background: var(--glass);
    backdrop-filter: blur(20px);
    -webkit-backdrop-filter: blur(20px);
    border-radius: 24px;
    border: 1px solid var(--border);
    margin: 20px;
    padding: 24px;
  }

  .target {
    box-shadow: 0 8px 32px rgba(0,0,0,0.2);
  }

  #plan { width:100%; padding:16px; font-size:48px; font-weight:800; text-align:center; background:transparent; border:none; color:var(--text); }

  .progress {
    height:16px; background:rgba(255,255,255,0.2); border-radius:8px; overflow:hidden; margin:20px 0;
  }
  .fill {
    height:100%; width:0%; background:linear-gradient(90deg,#007aff,#30d158); transition:width 0.6s ease;
  }
  .over { background:linear-gradient(90deg,#30d158,#ff9f0a); }

  .stats {
    text-align:center; font-size:32px; font-weight:800; margin-top:10px;
  }
  .over-text { color:#ff9f0a; font-size:36px; }

  .trucks {
    flex:1; overflow-y:auto; padding:0 20px 140px;
    -webkit-overflow-scrolling:touch;
  }
  .truck {
    display:flex; align-items:center; padding:20px;
    background:var(--glass-strong);
    border-radius:20px;
    margin-bottom:12px;
    border:1px solid var(--border);
    transition:transform 0.3s;
    position:relative;
    overflow:hidden;
  }
  .truck swipe {
    position:absolute; left:0; top:0; bottom:0; width:100px;
    background:#ff3b30; display:flex; align-items:center; justify-content:center;
    color:white; font-size:28px; transform:translateX(-100%);
    transition:transform 0.3s;
  }
  .truck.swiping .swipe { transform:translateX(0); }
  .truck.swiping .content { transform:translateX(80px); }

  .num { font-size:36px; font-weight:800; width:90px; text-align:center; }
  .count { font-size:60px; font-weight:900; min-width:120px; text-align:center; }
  .vol { margin-left:auto; font-size:26px; font-weight:600; color:var(--text-dim); }

  .btn {
    width:76px; height:76px; border-radius:38px; border:none;
    font-size:44px; color:white; font-weight:bold;
    box-shadow:0 8px 20px rgba(0,0,0,0.3);
    transition:all 0.2s;
  }
  .btn:active { transform:scale(0.92); }
  .plus { background:var(--accent); }
  .minus { background:var(--red); }

  .bottom-bar {
    position:fixed; bottom:0; left:0; right:0;
    padding:20px; padding-bottom:max(20px,env(safe-area-inset-bottom));
    background: var(--glass);
    backdrop-filter: blur(30px);
    -webkit-backdrop-filter: blur(30px);
    border-top:1px solid var(--border);
    display:flex; gap:12px;
  }
  .fab {
    flex:1; padding:18px; font-size:20px; font-weight:700;
    border-radius:18px; border:none; color:white;
  }
  .fab-green { background:var(--green); box-shadow:0 8px 30px rgba(48,209,88,0.4); }
  .fab-blue { background:var(--accent); }
  .fab-red { background:var(--red); }

  .timer {
    text-align:center; font-size:28px; font-weight:600; margin:20px 0; color:var(--text-dim);
  }
</style>
</head>
<body>

<div class="header">–≠–∫—Å–∫–∞–≤–∞—Ç–æ—Ä</div>

<div class="glass target">
  <div style="font-size:18px; color:var(--text-dim); text-align:center; margin-bottom:8px;">–ù–∞—Ä—è–¥ –Ω–∞ —Å–º–µ–Ω—É</div>
  <input id="plan" type="number" value="3000">
  <div class="progress"><div class="fill" id="fill"></div></div>
  <div class="stats" id="stats">0 / 3000 –º¬≥</div>
  <div class="stats over-text" id="over" style="display:none">+0 –º¬≥</div>
</div>

<div class="timer" id="timer">–°–º–µ–Ω–∞: --:--:--</div>

<div class="trucks" id="list"></div>

<div class="bottom-bar">
  <button class="fab fab-blue" onclick="addTruck()">+ –ë–µ–ª–ê–ó</button>
  <button class="fab fab-green" onclick="copyAll()">–î–∏—Å–ø–µ—Ç—á–µ—Ä—É</button>
  <button class="fab fab-red" onclick="resetShift()">–°–±—Ä–æ—Å</button>
</div>

<script>
  const V = 37.8;
  let trucks = JSON.parse(localStorage.getItem('exc2026')) || [];
  let target = +localStorage.getItem('exc2026_plan') || 3000;
  let shiftStart = +localStorage.getItem('exc2026_start') || Date.now();

  document.getElementById('plan').value = target;

  function save() {
    localStorage.setItem('exc2026', JSON.stringify(trucks));
    localStorage.setItem('exc2026_plan', target);
    localStorage.setItem('exc2026_start', shiftStart);
  }

  function update() {
    const total = trucks.reduce((s,t)=>s+t.c*V, 0);
    const perc = Math.min(total/target*100, 200);
    document.getElementById('fill').style.width = perc + '%';
    document.getElementById('stats').textContent = `${Math.round(total).toLocaleString()} / ${target.toLocaleString()} –º¬≥`;
    const over = total > target;
    document.getElementById('over').style.display = over ? 'block' : 'none';
    if (over) {
      document.getElementById('over').textContent = `+${Math.round(total-target).toLocaleString()} –º¬≥ üî•`;
      document.getElementById('fill').classList.add('over');
    } else {
      document.getElementById('fill').classList.remove('over');
    }
  }

  function render() {
    const list = document.getElementById('list');
    list.innerHTML = trucks.map((t,i) => `
      <div class="truck" data-i="${i}" onpointerdown="startSwipe(event,this)">
        <div class="swipe">–£–¥–∞–ª–∏—Ç—å</div>
        <div class="content">
          <div class="num">${t.n}</div>
          <button class="btn minus" onclick="ch(${i},-1)">‚Äì</button>
          <div class="count">${t.c}</div>
          <button class="btn plus" onclick="ch(${i},1)">+</button>
          <div class="vol">${(t.c*V).toFixed(1)} –º¬≥</div>
        </div>
      </div>
    `).join('');
    update();
  }

  window.ch = (i,d) => {
    trucks[i].c = Math.max(0, trucks[i].c + d);
    save(); render();
    navigator.vibrate?.(30);
  }

  window.addTruck = () => {
    const num = prompt('–ù–æ–º–µ—Ä –ë–µ–ª–ê–ó–∞:');
    if (!num) return;
    const up = num.trim().toUpperCase();
    if (trucks.some(t=>t.n===up)) return alert('–£–∂–µ –µ—Å—Ç—å');
    trucks.push({n:up, c:0});
    save(); render();
  }

  let swipeEl = null, startX = 0;
  window.startSwipe = (e, el) => {
    if (e.pointerType === 'mouse') return;
    swipeEl = el;
    startX = e.touches[0].clientX;
    const move = (e) => {
      const x = e.touches[0].clientX;
      const diff = x - startX;
      if (diff < -30) el.classList.add('swiping');
    };
    const up = (e) => {
      if (e.changedTouches[0].clientX - startX < -80) {
        const i = el.dataset.i;
        trucks.splice(i,1);
        save(); render();
      }
      el.classList.remove('swiping');
      document.removeEventListener('touchmove', move);
      document.removeEventListener('touchend', up);
    };
    document.addEventListener('touchmove', move);
    document.addEventListener('touchend', up);
  }

  document.getElementById('plan').onchange = e => {
    target = Math.max(0, +e.target.value || 0);
    save(); update();
  }

  window.copyAll = () => {
    const text = trucks.filter(t=>t.c>0).map(t=>`${t.n} ‚Äî ${t.c} —Ä–µ–π—Å${t.c>1?'–∞':''}`).join('\n') || '–†–µ–π—Å–æ–≤ –Ω–µ—Ç';
    navigator.clipboard.writeText(text);
    alert('–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ!\n\n' + text);
  }

  window.resetShift = () => {
    if (confirm('–°–±—Ä–æ—Å–∏—Ç—å —Å–º–µ–Ω—É?')) {
      trucks = [];
      shiftStart = Date.now();
      save(); render();
    }
  }

  // –¢–∞–π–º–µ—Ä —Å–º–µ–Ω—ã
  setInterval(() => {
    const sec = Math.floor((Date.now() - shiftStart)/1000);
    const h = String(Math.floor(sec/3600)).padStart(2,'0');
    const m = String(Math.floor(sec%3600/60)).padStart(2,'0');
    const s = String(sec%60).padStart(2,'0');
    document.getElementById('timer').textContent = `–°–º–µ–Ω–∞: ${h}:${m}:${s}`;
    if (sec > 12*3600) document.getElementById('timer').style.color = '#ff3b30';
  }, 500);

  render();
</script>
</body>
</html>
